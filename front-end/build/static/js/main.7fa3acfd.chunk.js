(this["webpackJsonpfront-end"]=this["webpackJsonpfront-end"]||[]).push([[0],{162:function(e,t,n){e.exports={"map-container":"Map_map-container__88-xY",editor:"Map_editor__339_t",zoom:"Map_zoom__3w-HR"}},231:function(e,t,n){},242:function(e,t,n){},322:function(e,t){},323:function(e,t){},324:function(e,t){},325:function(e,t){},326:function(e,t){},327:function(e,t){},342:function(e,t,n){},347:function(e,t,n){},378:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),i=n(28),s=n.n(i),r=(n(231),n(83)),o=n(9),l=n(15),d=n.n(l),u=n(26),j=n(35),h=n(36),b=n(53),p=n(44),f=n(43),m=n(30),O=n.n(m),v=n(221),x=n(394),g=n(69),y=(n(242),n(40)),w=n(387),C=n(390),k=n(400),S=n(397),I=n(403),L=n(402),E=n(423),T=n(424),F=n(425),M=n(426),N=n(414),R=n(427),D=n(381),P={},V=n(388),z=n(398),K=n(2),A=[],_=V.a.Text;function B(e){var t=e.playAudio,n=e.serverConfig,c=e.onEnter,i=e.changeChannel,s=e.channelList,r=void 0===s?[]:s,o=e.channelStatus,l=void 0===o?{}:o,d=n.audioList,u=void 0===d?[]:d;return Object(D.a)((function(){return!0}),(function(e){var t=e.type,n=e.key;console.log(n,t),r.forEach((function(e){var a=e.pin,c=e.keyboard,s=void 0===c?[]:c,r=e.type;s.forEach((function(c){var s=c.name,o=c.speed,d=c.method,u=c.autoReset;if(s.toLocaleLowerCase()===n.toLocaleLowerCase())if("switch"===r){if("keydown"===t){var j=!l[a];return void i({pin:a,value:j})}if("keyup"===t&&u)return void i({pin:a,value:0})}else"step"===d?("keydown"===t&&A.push({pressedKey:c,channel:e}),"keyup"===t&&(A=A.filter((function(e){return e.pressedKey.key===n})))):("keydown"===t&&i({pin:a,value:o}),"keyup"===t&&u&&i({pin:a,value:0}))}))}))}),{events:["keydown","keyup"]}),Object(D.a)((function(){return!0}),(function(e){var n=e.key;u.forEach((function(e){var a=e.path,c=e.text,i=e.keyboard,s=void 0===i?"":i,r=e.type;if(s.toLocaleLowerCase()===n.toLocaleLowerCase())switch(r){case"audio":t({path:a});break;case"text":t({text:c});break;case"stop":t({stop:!0})}}))}),{events:["keydown"]}),Object(D.a)("enter",c),Object(a.useEffect)((function(){console.log("changeChannel change");var e=setInterval((function(){A.forEach((function(e){var t=e.pressedKey,n=t.positive,a=t.speed,c=void 0===a?.5:a,s=e.channel.pin,r=(P[s]||0)+(n?1:-1)*c/10;r>1&&(r=1),r<-1&&(r=-1),i({pin:s,value:r})}))}),100);return function(){clearInterval(e)}}),[i]),Object(K.jsx)(k.a,{placement:"topLeft",overlayClassName:"popovertip",content:Object(K.jsxs)(z.b,{title:"\u952e\u76d8",bordered:!0,children:[Object(K.jsx)(z.b.Item,{label:"\u64ad\u653e\u58f0\u97f3",children:u.map((function(e,t){var n=e.name,a=e.keyboard,c=void 0===a?"":a,i=e.type;return Object(K.jsxs)("p",{children:["stop"===i?"\u505c\u6b62\u64ad\u653e":Object(K.jsxs)(K.Fragment,{children:["\u64ad\u653e ",Object(K.jsx)(_,{code:!0,children:n})]}),":",Object(K.jsx)(_,{keyboard:!0,children:c})]},"".concat(n,"-").concat(t))}))}),r.map((function(e){var t=e.pin,n=e.name,a=e.keyboard,c=void 0===a?[]:a,i=e.type;return Object(K.jsx)(z.b.Item,{label:Object(K.jsxs)(K.Fragment,{children:[n," ",Object(K.jsxs)(_,{code:!0,children:["\u901a\u9053:",t]})]}),children:c.map((function(e){var t=e.name,a=e.speed,c=e.autoReset;return Object(K.jsxs)("p",{children:[n,Object(K.jsxs)(_,{code:!0,children:[i,":",a]}),":",Object(K.jsx)(_,{keyboard:!0,children:t}),c&&Object(K.jsx)(_,{type:"secondary",children:"\u91ca\u653e\u5f52\u4f4d"})]},t)}))},t)})),Object(K.jsx)(z.b.Item,{label:"\u53d1\u9001\u6587\u5b57\u8f6c\u8bed\u97f3",children:Object(K.jsx)(_,{keyboard:!0,children:"\u56de\u8f66"})}),Object(K.jsx)(z.b.Item,{label:"\u53d1\u9001\u8bed\u97f3/\u5f00\u5173\u63a7\u5236\u7aef\u9ea6\u514b\u98ce",children:Object(K.jsx)(_,{keyboard:!0,children:"\u7a7a\u683c"})})]}),children:Object(K.jsx)(g.a,{shape:"round",children:"\u2328\ufe0f"})})}var U=n(393),W=n(205),G=n(392),q=n(401),H=n(410),J=n(412),Y=n(413),X=n(405),Z=n(406),Q=n(407),$=n(408),ee=n(409),te=n(411),ne=n(61),ae=n(386),ce=n(389),ie=n(399),se=n(34),re={labelCol:{span:6},wrapperCol:{span:16}},oe={wrapperCol:{offset:6,span:16}};function le(){return de.apply(this,arguments)}function de(){return(de=Object(u.a)(d.a.mark((function e(){var t,n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,se.d("https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_1.0_224/model.json");case 2:return t=e.sent,n=t.getLayer("conv_pw_13_relu"),e.abrupt("return",se.e({inputs:t.inputs,outputs:n.output}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ue(e){return je.apply(this,arguments)}function je(){return(je=Object(u.a)(d.a.mark((function e(t){var n,a,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=document.getElementById("small-canvas"))||((n=document.createElement("canvas")).id="small-canvas",n.width=224,n.height=224),a=se.a.fromPixels(t),c=a.resizeNearestNeighbor([224,224]),e.next=6,se.a.toPixels(c,n);case 6:return e.abrupt("return",n.toDataURL());case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function he(e){return be.apply(this,arguments)}function be(){return(be=Object(u.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){var n=new Image;n.addEventListener("load",(function(){e(se.a.fromPixels(n))})),n.src=t}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var pe=function(){function e(){var t=this;return Object(j.a)(this,e),Object(u.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,le();case 2:return t.truncatedMobileNet=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})))()}return Object(h.a)(e,[{key:"addExample",value:function(){var e=Object(u.a)(d.a.mark((function e(t,n){var a,c,i,s,r,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,he(t);case 2:a=e.sent,c=se.j((function(){return a.expandDims(0).toFloat().div(127).sub(1)})),i=this.truncatedMobileNet.predict(c),c.dispose(),s=se.j((function(){return se.g(se.i([n]).toInt(),5)})),null==this.xs?(this.xs=se.b(i),this.ys=se.b(s)):(r=this.xs,this.xs=se.b(r.concat(i,0)),o=this.ys,this.ys=se.b(o.concat(s,0)),r.dispose(),o.dispose(),s.dispose());case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"clean",value:function(){this.xs&&(this.xs.dispose(),this.ys.dispose(),this.xs=null,this.ys=null)}},{key:"train",value:function(){var e=Object(u.a)(d.a.mark((function e(t,n){var a,c,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Learnning Argument",t),null!=this.xs){e.next=3;break}throw new Error("Add some examples before training!");case 3:if(a=se.h({layers:[se.c.flatten({inputShape:this.truncatedMobileNet.outputs[0].shape.slice(1)}),se.c.dense({units:t.hiddenUnits,activation:"relu",kernelInitializer:"varianceScaling",useBias:!0}),se.c.dense({units:5,kernelInitializer:"varianceScaling",useBias:!1,activation:"softmax"})]}),c=se.k.adam(t.learnRate),a.compile({optimizer:c,loss:"categoricalCrossentropy"}),(i=Math.floor(this.xs.shape[0]*t.batchSize))>0){e.next=9;break}throw new Error("Batch size is 0 or NaN. Please choose a non-zero fraction.");case 9:return e.next=11,a.fit(this.xs,this.ys,{batchSize:i,epochs:t.epochs,callbacks:{onBatchEnd:function(){var e=Object(u.a)(d.a.mark((function e(t,a){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Loss: "+a.loss.toFixed(5)),n(a.loss.toFixed(5));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}});case 11:return this.model=a,e.abrupt("return",a);case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"predict",value:function(){var e=Object(u.a)(d.a.mark((function e(t){var n,a,c,i,s,r;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=se.j((function(){return se.a.fromPixels(t).resizeNearestNeighbor([224,224]).expandDims(0).toFloat().div(127).sub(1)})),a=this.truncatedMobileNet.predict(n),c=this.model.predict(a),e.next=5,c.data();case 5:return i=e.sent,s=c.as1D().argMax(),e.next=9,s.data();case 9:return r=e.sent[0],console.log("Ai \u9884\u6d4b:",i),n.dispose(),e.next=14,se.f();case 14:return e.abrupt("return",{label:r,probability:i[r]});case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"save",value:function(){var e=Object(u.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.model.save("indexeddb://".concat(t));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=Object(u.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,se.d("indexeddb://".concat(t));case 2:this.model=e.sent;case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function fe(e){return me.apply(this,arguments)}function me(){return(me=Object(u.a)(d.a.mark((function e(t){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){setTimeout((function(){e()}),t)})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Oe=n(143),ve={left:{icon:Object(K.jsx)(X.a,{}),name:"\u5de6\u8f6c\u5f2f",action:{speed:1,direction:1},label:0},right:{icon:Object(K.jsx)(Z.a,{}),name:"\u53f3\u8f6c\u5f2f",action:{speed:1,direction:-1},label:1},forward:{icon:Object(K.jsx)(Q.a,{}),name:"\u524d\u8fdb",action:{speed:1,direction:0},label:2},back:{icon:Object(K.jsx)($.a,{}),action:{speed:-1,direction:0},name:"\u540e\u9000",label:3},stop:{icon:Object(K.jsx)(ee.a,{}),action:{speed:0,direction:0},name:"\u505c\u6b62",label:4}},xe=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).clear=function(){a.setState({sampleList:[]})},a.upload=function(e){var t=e.file,n=e.onSuccess,c=new FileReader;return c.onload=function(e){var t=e.target.result,c=JSON.parse(t),i=a.state.sampleList;a.setState({sampleList:i.concat(c)}),n()},c.readAsText(t),!0},a.download=function(){var e=a.state,t=e.sampleList,n=e.exportName;Object(Oe.saveAs)(new Blob([JSON.stringify(t)]),"".concat(n,".json"))},a.state={sampleList:e.sampleList||[],exportName:"\u81ea\u52a8\u9a7e\u9a76\u5b66\u4e60\u6837\u672c"},a}return Object(h.a)(n,[{key:"componentDidMount",value:function(){this.props.controller.changeCamera(!0)}},{key:"add",value:function(){var e=Object(u.a)(d.a.mark((function e(t){var n,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.props.canvasRef,a=this.state.sampleList,e.t0=a,e.t1=o.a,e.t2=Object(o.a)({},t),e.t3={},e.next=8,ue(n);case 8:e.t4=e.sent,e.t5={img:e.t4},e.t6=(0,e.t1)(e.t2,e.t3,e.t5),e.t0.unshift.call(e.t0,e.t6),this.setState({sampleList:a});case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(e,t){this.setState((function(n){return n.sampleList[e].action=t,n}))}},{key:"remove",value:function(e){var t=this.state.sampleList;t.splice(e,1),this.setState({sampleList:t})}},{key:"render",value:function(){var e=this,t=this.clear,n=this.download,a=this.upload,c=this.props,i=c.onFinish,s=c.cameraEnabled,r=this.state.sampleList;return Object(K.jsxs)("div",{className:"ai-sample",children:[Object(K.jsxs)(w.a,{layout:"inline",className:"ai-sample-form",children:[Object.keys(ve).map((function(t){return Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(g.a,{icon:ve[t].icon,onClick:function(){return e.add({action:t})},disabled:!s,children:ve[t].name})})})),Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(ae.a,{customRequest:a,accept:"application/json",showUploadList:!1,children:Object(K.jsx)(g.a,{icon:Object(K.jsx)(H.a,{}),children:"\u5bfc\u5165"})})}),Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(g.a,{icon:Object(K.jsx)(te.a,{}),disabled:!r.length,onClick:n,children:"\u5bfc\u51fa"})}),Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(g.a,{type:"danger",disabled:!r.length,onClick:t,children:"\u6e05\u9664"})}),Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(y.a,{to:"../train",children:Object(K.jsx)(g.a,{type:"primary",disabled:r.length<10,onClick:function(){i(r)},children:"\u4e0b\u4e00\u6b65"})})})]}),Object(K.jsx)(ce.b,{size:"small",className:"ai-example-list",grid:{gutter:16,column:4},itemLayout:"vertical",pagination:{pageSize:12},dataSource:r,renderItem:function(t,n){var a=t.img,c=t.action;return Object(K.jsx)(ce.b.Item,{children:Object(K.jsx)(ie.a,{size:"small",title:ve[c].icon,actions:[Object(K.jsx)(g.a,{size:"small",icon:Object(K.jsx)(ne.a,{}),type:"danger",onClick:function(){return e.remove(n)}})],children:Object(K.jsx)("img",{style:{width:"100%"},src:a,alt:"example",onLoad:function(e){var t=e.target;t.height=.75*t.width}})})})}})]})}}]),n}(a.Component),ge=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).predict=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=a.props,n=t.ai,c=t.onAi,i=void 0===c?function(){}:c,s=t.canvasRef;i(!0),a.setState({isPredicting:!0},Object(u.a)(d.a.mark((function t(){var c,r,o,l;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!a.state.isPredicting){t.next=13;break}return t.next=3,n.predict(s);case 3:return c=t.sent,r=c.label,o=c.probability,l=a.labelToKey(r),a.setState({actionKey:l,probability:o}),e(l),t.next=11,fe(a.state.interval);case 11:t.next=0;break;case 13:i(!1);case 14:case"end":return t.stop()}}),t)}))))},a.test=function(){a.predict()},a.drive=function(){a.predict((function(e){var t=a.props.controller,n=t.speed,c=t.direction,i=ve[e].action;n(0),n(i.speed),c(i.direction)}))},a.stop=function(){a.setState({isPredicting:!1})},a.loadModel=Object(u.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.props.ai.load("test");case 2:v.b.success("\u6a21\u578b\u5df2\u7ecf\u52a0\u8f7d\uff01");case 3:case"end":return e.stop()}}),e)}))),a.downloadModel=function(){},a.state={isPredicting:!1,actionKey:"stop",interval:200,probability:0},a}return Object(h.a)(n,[{key:"componentDidMount",value:function(){this.props.controller.changeCamera(!0)}},{key:"labelToKey",value:function(e){return Object.keys(ve).find((function(t){return ve[t].label===e}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.isPredicting,a=t.actionKey,c=t.probability,i=t.interval,s=this.props,r=s.cameraEnabled,o=s.ai,l=this.drive,d=this.stop,u=this.test,j=this.loadModel;return Object(K.jsxs)("div",{className:"ai-train",children:[Object(K.jsxs)(w.a,{layout:"inline",children:[Object(K.jsx)(w.a.Item,{label:"\u64cd\u4f5c\u95f4\u9694",children:Object(K.jsx)(G.a,{value:i,onChange:function(t){return e.setState({interval:t})}})}),Object(K.jsx)(w.a.Item,{label:"\u52a8\u4f5c",children:Object(K.jsxs)(q.a,{children:[ve[a].name," ",ve[a].icon," ",c.toFixed(2)]})})]}),Object(K.jsx)("br",{}),Object(K.jsxs)(w.a,{layout:"inline",children:[Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(g.a,{icon:Object(K.jsx)(H.a,{}),loading:n,onClick:j,children:"\u5bfc\u5165\u6a21\u578b"})}),Object(K.jsxs)(w.a.Item,{children:[Object(K.jsx)(g.a,{icon:Object(K.jsx)(J.a,{}),loading:n,onClick:u,disabled:!r||!o||!o.model,children:"\u6d4b\u8bd5"}),"\xa0\xa0\xa0\xa0",Object(K.jsx)(g.a,{type:"danger",loading:n,onClick:l,icon:Object(K.jsx)(Y.a,{}),disabled:!r||!o||!o.model,children:"\u5f00\u59cb Ai \u9a7e\u9a76"},"predic")]}),Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(g.a,{onClick:d,icon:Object(K.jsx)(N.a,{}),disabled:!n,children:"\u505c\u6b62 Ai \u9a7e\u9a76"},"stop")}),Object(K.jsx)("br",{})]})]})}}]),n}(a.Component),ye=n(116),we=n(415),Ce=ye.a.Option,ke=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var c;return Object(j.a)(this,n),(c=t.call(this,e)).train=function(){var e=Object(u.a)(d.a.mark((function e(t){var n,a,i,s,r,o,l,u;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Object(b.a)(c),a=n.props,i=a.sampleList,s=a.ai,c.setState({loading:"\u6570\u636e\u5904\u7406..."}),s.clean(),r=0;case 4:if(!(r<i.length)){e.next=11;break}return o=i[r],l=o.img,u=o.action,e.next=8,s.addExample(l,ve[u].label);case 8:r++,e.next=4;break;case 11:return c.setState({loading:"\u8bad\u7ec3..."}),e.next=14,s.train(t,(function(e){return c.setState({loss:e})}));case 14:c.setState({loading:!1});case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c.state={learnArgument:{learnRate:1e-4,batchSize:.4,epochs:20,hiddenUnits:100},loss:void 0,loading:!1,model:void 0},c.smallCanvasRef=Object(a.createRef)(),c}return Object(h.a)(n,[{key:"componentDidMount",value:function(){this.props.controller.changeCamera(!1)}},{key:"render",value:function(){var e=this.state,t=e.learnArgument,n=e.loss,a=e.loading,c=this.props,i=c.sampleList,s=c.ai,r=this.train;return Object(K.jsx)("div",{className:"ai-train",children:Object(K.jsxs)(W.a,{spinning:a,tip:a,children:[Object(K.jsxs)(w.a,Object(o.a)(Object(o.a)({},re),{},{initialValues:t,onFinish:r,children:[Object(K.jsx)(w.a.Item,{label:"Learning rate",name:"learnRate",children:Object(K.jsxs)(ye.a,{children:[Object(K.jsx)(Ce,{value:1e-5,children:"0.00001"}),Object(K.jsx)(Ce,{value:1e-4,children:"0.0001"}),Object(K.jsx)(Ce,{value:.001,children:"0.001"}),Object(K.jsx)(Ce,{value:.003,children:"0.003"})]})}),Object(K.jsx)(w.a.Item,{label:"Batch Size",name:"batchSize",children:Object(K.jsxs)(ye.a,{children:[Object(K.jsx)(Ce,{value:.05,children:"0.05"}),Object(K.jsx)(Ce,{value:.1,children:"0.1"}),Object(K.jsx)(Ce,{value:.4,children:"0.4"}),Object(K.jsx)(Ce,{value:1,children:"1"})]})}),Object(K.jsx)(w.a.Item,{label:"Epochs",name:"epochs",children:Object(K.jsxs)(ye.a,{children:[Object(K.jsx)(Ce,{value:10,children:"10"}),Object(K.jsx)(Ce,{value:20,children:"20"}),Object(K.jsx)(Ce,{value:40,children:"40"})]})}),Object(K.jsx)(w.a.Item,{label:"Hidden units",name:"hiddenUnits",children:Object(K.jsxs)(ye.a,{children:[Object(K.jsx)(Ce,{value:100,children:"100"}),Object(K.jsx)(Ce,{value:200,children:"200"}),Object(K.jsx)(Ce,{value:300,children:"300"}),Object(K.jsx)(Ce,{value:400,children:"400"}),Object(K.jsx)(Ce,{value:500,children:"500"})]})}),Object(K.jsx)(w.a.Item,{label:"loss",children:Object(K.jsx)(G.a,{value:n,disabled:!0})}),Object(K.jsxs)(w.a.Item,Object(o.a)(Object(o.a)({},oe),{},{children:[Object(K.jsxs)(g.a,{loading:a,disabled:!i.length,icon:Object(K.jsx)(we.a,{}),htmlType:"submit",children:["\u5b66\u4e60(\u6837\u672c",i.length,")"]},"fit"),"\xa0 \xa0 \xa0 \xa0",Object(K.jsx)(g.a,{onClick:Object(u.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.save("test");case 2:v.b.success("\u6a21\u578b\u5df2\u7ecf\u4fdd\u5b58");case 3:case"end":return e.stop()}}),e)}))),icon:Object(K.jsx)(te.a,{}),disabled:!i.length,children:"\u5bfc\u51fa\u6a21\u578b"})]}))]})),Object(K.jsx)(w.a,{children:Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},oe),{},{children:Object(K.jsx)(y.a,{to:"../drive",children:Object(K.jsx)(g.a,{type:"primary",disabled:!s||!s.model,children:"\u4e0b\u4e00\u6b65"})})}))})]})})}}]),n}(a.Component),Se=[{key:"sample",name:"\u91c7\u96c6\u6837\u672c"},{key:"train",name:"\u5b66\u4e60\u8bad\u7ec3"},{key:"drive",name:"\u81ea\u52a8\u9a7e\u9a76"}],Ie=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var a;return Object(j.a)(this,n),(a=t.call(this,e)).menuItem=function(e){var t=e.key,n=e.name;return Object(K.jsx)(U.a.Item,{children:Object(K.jsx)(y.a,{to:"./".concat(t),children:n})},t)},a.state={learnForm:{},exampleList:[],sampleList:[],loading:!1,isPredicting:!1,loss:0},a}return Object(h.a)(n,[{key:"componentDidMount",value:function(){var e=Object(u.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:"\u52a0\u8f7d MobileNet..."}),e.next=3,new pe;case 3:t=e.sent,this.setState({loading:!1,ai:t});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,n=t.sampleList,a=t.ai,c=t.loading,i=this.props,s=i.controller,r=i.cameraEnabled,o=i.canvasRef,l=this.menuItem;return Object(K.jsxs)(W.a,{spinning:c,tip:c,children:[Object(K.jsx)(y.b,{path:":current",children:function(e){return Object(K.jsx)(U.a,{selectedKeys:[e.match&&e.match.current],mode:"horizontal",children:Se.map((function(e){return l(e)}))})}}),Object(K.jsxs)(y.c,{children:[Object(K.jsx)(xe,{path:"sample",onFinish:function(t){return e.setState({sampleList:t})},sampleList:n,canvasRef:o,cameraEnabled:r,controller:s}),Object(K.jsx)(ke,{path:"train",sampleList:n,controller:s,ai:a}),Object(K.jsx)(ge,{path:"drive",controller:s,canvasRef:o,cameraEnabled:r,ai:a})]})]})}}]),n}(a.Component),Le=n(23),Ee=n(73),Te=n(207),Fe=function(){function e(){var t=this;return Object(j.a)(this,e),Object(u.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Te.load({base:"mobilenet_v2"});case 2:return t.model=e.sent,console.log("model loaded"),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})))()}return Object(h.a)(e,[{key:"predict",value:function(){var e=Object(u.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.model.detect(t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Me=n(395),Ne=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var c;return Object(j.a)(this,n),(c=t.call(this,e)).detect=Object(u.a)(d.a.mark((function e(){var t,n,a,i,s,r,o,l,u,j,h;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Object(b.a)(c),n=t.state,a=n.targetClass,i=n.threshold,s=n.detectionList,r=t.props,o=r.videoEl,l=r.cameraEnabled,u=t.draw,l){e.next=3;break}return e.abrupt("return");case 3:return console.time("predict"),e.next=6,c.cocoSSD.predict(o);case 6:return j=e.sent,console.timeEnd("predict"),j.forEach((function(e){s.some((function(t){return e.class===t}))||s.push(e.class),a&&e.class===a&&e.score>i/100&&(h?h.score<e.score&&(h=e):h=e)})),u(j,h),e.abrupt("return",h);case 11:case"end":return e.stop()}}),e)}))),c.draw=function(e,t){var n=Object(b.a)(c).canvas,a=n.current.getContext("2d");a.clearRect(0,0,n.current.width,n.current.height),a.font="10px Arial";for(var i=0;i<e.length;i++)a.beginPath(),a.rect.apply(a,Object(Ee.a)(e[i].bbox)),a.lineWidth=1,a.strokeStyle=e[i]===t?"red":"green",a.fillStyle=e[i]===t?"red":"green",a.stroke(),a.fillText(e[i].score.toFixed(3)+" "+e[i].class,e[i].bbox[0],e[i].bbox[1]>10?e[i].bbox[1]-5:10)},c.startDetect=Object(u.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c.setState({detecting:!0},Object(u.a)(d.a.mark((function e(){var t;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c.state.detecting){e.next=9;break}return e.next=3,c.detect();case 3:return t=e.sent,c.state.driving&&c.drive(t),e.next=7,fe(c.state.interval);case 7:e.next=0;break;case 9:case"end":return e.stop()}}),e)}))));case 1:case"end":return e.stop()}}),e)}))),c.stopDetect=Object(u.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c.setState({detecting:!1,driving:!1});case 1:case"end":return e.stop()}}),e)}))),c.drive=function(){var e=Object(u.a)(d.a.mark((function e(t){var n,a,i,s,r,o,l,j,h,p,f,m,O,v,x,g,y,w,C;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p=function(){return(p=Object(u.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==l.speed){e.next=2;break}return e.abrupt("return");case 2:return r(-.5),e.next=5,fe(50);case 5:r(0);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)},h=function(){return p.apply(this,arguments)},n=Object(b.a)(c),a=n.props,i=a.video,s=a.controller,r=s.speed,o=s.direction,l=a.action,j=n.state.pauseThreshold,t&&i){e.next=6;break}return h(),e.abrupt("return");case 6:if(f=i.width,m=i.height,O=Object(Le.a)(t.bbox,4),v=O[0],O[1],x=O[2],g=O[3],y=v+x/2,w=g/m,!(Math.abs(w-j/100)<.05)){e.next=13;break}return h(),e.abrupt("return");case 13:r(C=w>j/100?-1:1),o(1.3*(y/f*-2+1)*C);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c.start=function(){c.setState({driving:!0}),c.props.onAi(!0)},c.stop=function(){c.setState({driving:!1}),c.props.controller.speed(-.1),c.props.controller.speed(0),c.props.onAi(!1)},c.state={loading:!1,targetClass:"person",threshold:50,detectionList:["person"],interval:100,driving:!1,detecting:!1,pauseThreshold:60},c.canvas=Object(a.createRef)(),c}return Object(h.a)(n,[{key:"componentDidMount",value:function(){var e=Object(u.a)(d.a.mark((function e(){return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:"\u52a0\u8f7d\u6a21\u578b..."}),e.next=3,new Fe;case 3:this.cocoSSD=e.sent,this.setState({loading:!1}),this.props.controller.changeCamera(!0);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.state,n=t.loading,a=t.threshold,c=t.interval,i=t.detecting,s=t.driving,r=t.detectionList,o=t.targetClass,l=t.pauseThreshold,d=this.props,u=d.videoSize,j=d.cameraEnabled,h=d.action,b=d.videoEl,p=this.startDetect,f=this.start,m=this.stop,O=this.stopDetect;return Object(K.jsxs)("div",{className:"ai-object-detection",children:[Object(K.jsx)(W.a,{spinning:n,tip:n,children:Object(K.jsxs)(w.a,{className:"inline-form",layout:"inline",style:{padding:"1em"},size:"small",children:[Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(L.a,{onChange:function(e){return e?p():O()},checked:i,disabled:!j,checkedChildren:"\u68c0\u6d4b",unCheckedChildren:"\u68c0\u6d4b"})}),Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(k.a,{placement:"topLeft",content:Object(K.jsx)(Me.a.Group,{onChange:function(t){var n=t.target.value;return e.setState({targetClass:n})},value:o,children:r.map((function(e){return Object(K.jsx)(Me.a,{value:e,children:e})}))}),children:Object(K.jsxs)(g.a,{shape:"round",children:["\u76ee\u6807:",o||"\u65e0"]})})}),Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(k.a,{placement:"topLeft",content:Object(K.jsx)(C.a,{min:0,max:100,value:a,onChange:function(t){return e.setState({threshold:t})},arrowPointAtCenter:!0,style:{width:"30vw"}}),children:Object(K.jsxs)(g.a,{shape:"round",children:["\u76ee\u6807\u9600\u503c:",a]})})}),Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(k.a,{placement:"topLeft",content:Object(K.jsx)(C.a,{min:0,max:100,value:l,onChange:function(t){return e.setState({pauseThreshold:t})},arrowPointAtCenter:!0,style:{width:"30vw"}}),children:Object(K.jsxs)(g.a,{shape:"round",children:["\u8ddf\u968f\u9600\u503c:",l]})})}),Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(k.a,{placement:"topLeft",content:Object(K.jsx)(G.a,{min:0,max:1e3,value:c,onChange:function(t){return e.setState({interval:t})}}),children:Object(K.jsxs)(g.a,{shape:"round",children:["\u95f4\u9694:",c," ms"]})})}),Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(g.a,{icon:Object(K.jsx)(Y.a,{}),type:"danger",onClick:f,disabled:!i||s||!o,children:"\u5f00\u59cb\u9a7e\u9a76"})}),Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(g.a,{icon:Object(K.jsx)(N.a,{}),onClick:m,disabled:!s,children:"\u505c\u6b62\u9a7e\u9a76"})}),Object(K.jsxs)(w.a.Item,{children:[Object(K.jsxs)(q.a,{children:["\u65b9\u5411",h.direction.toFixed(2)]}),Object(K.jsxs)(q.a,{children:["\u6cb9\u95e8",h.speed.toFixed(2)]})]})]})}),Object(K.jsx)("div",{className:"ai-object-detection-canvas-container",style:{opacity:j?1:0,transform:"scale(".concat(u/50,")")},children:b&&Object(K.jsx)("canvas",{ref:this.canvas,width:b.width,height:b.height})})]})}}]),n}(a.Component),Re=n(382),De=n(171),Pe=n.n(De),Ve=n(416),ze=n.p+"static/media/\u5f00\u9a82.f0021341.gif";function Ke(e){var t=e.url,n=Object(a.useState)(void 0),c=Object(Le.a)(n,2),i=c[0],s=c[1],r=Object(a.useState)(void 0),o=Object(Le.a)(r,2),l=o[0],d=o[1],u=Object(a.useState)(void 0),j=Object(Le.a)(u,2),h=j[0],b=j[1],p=Object(a.useState)(!1),f=Object(Le.a)(p,2),m=f[0],O=f[1];Object(a.useEffect)((function(){if(t){var e=new WebSocket(t),n=function(){return d(!0)},a=function(){return d(!1)};return e.addEventListener("open",n),e.addEventListener("close",a),b(e),function(){e&&(e.close(),e.removeEventListener("open",n),e.removeEventListener("close",a)),b(void 0)}}}),[t]);var x=function(){m||navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){O(!0);var t=new Pe.a(e,{type:"audio",mimeType:"audio/wav",sampleRate:16e3,desiredSampRate:16e3,bufferSize:256,recorderType:De.StereoAudioRecorder,numberOfAudioChannels:1});t.startRecording(),s(t)})).catch((function(e){console.error(e),v.b.error(e.message)}))},y=function(){m&&(O(!1),i&&h&&i.stopRecording((function(){var e=i.getBlob();h.send(e),v.b.success("\u53d1\u9001\u8bed\u97f3")})))};return Object(D.a)("space",x),Object(D.a)("space",y,{events:["keyup"]}),Object(Re.a)("gamepadpress",(function(e){var t=e.detail,n=t.index,a=t.value;2===n&&(a>.5?x():y())})),Object(K.jsx)(k.a,{visible:m,placement:"leftBottom",content:Object(K.jsx)("img",{className:"select-disabled recording-img",src:ze,alt:"\u5f55\u97f3\u4e2d"}),children:Object(K.jsx)(g.a,{className:"record-button",size:"large",disabled:!l,shape:"circle",onTouchStart:x,onTouchEnd:y,icon:Object(K.jsx)(Ve.a,{})})})}n(342);var Ae=n(6),_e=n.n(Ae),Be=n(99),Ue=n.n(Be),We=function e(t){return null===t.offsetParent?0:t.offsetLeft+e(t.offsetParent)},Ge=function e(t){return null===t.offsetParent?0:t.offsetTop+e(t.offsetParent)};function qe(e){var t=e.onChange,n=e.name,c=e.autoReset,i=e.disabled,s=e.position,r=void 0===s?{x:0,y:0}:s,o=e.enabledX,l=void 0===o||o,d=e.enabledY,u=void 0===d||d,j=Object(a.useRef)(null),h=Object(a.useRef)(null),b=Object(a.useState)({x:0,y:0}),p=Object(Le.a)(b,2),f=p[0],m=p[1],O=Object(a.useState)(!1),v=Object(Le.a)(O,2),x=v[0],g=v[1],y=Object(a.useState)(),w=Object(Le.a)(y,2),C=w[0],k=w[1],S=Object(a.useState)(void 0),I=Object(Le.a)(S,2),L=I[0],E=I[1],T=Object(a.useMemo)((function(){return Ue()((function(){for(var e,n=arguments.length,a=new Array(n),c=0;c<n;c++)a[c]=arguments[c];(e=console).log.apply(e,["onChange"].concat(a)),t.apply(void 0,a)}),50,{leading:!1,trailing:!0})}),[t]),F=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{x:0,y:0},t=e.x,n=e.y;if(l){var a=We(j.current)+r.x;(t=-(t=(t-a)/h.current.clientWidth*2-1))>1&&(t=1),t<-1&&(t=-1)}else t=0;if(u){var c=Ge(j.current)+r.y;(n=-(n=(n-c)/h.current.clientHeight*2-1))>1&&(n=1),n<-1&&(n=-1)}else n=0;m({x:t,y:n}),T({x:t,y:n})},M=function(e){var t=e.x,n=e.y;if(!i){var a=(new Date).getTime();if(Math.abs(a-C)<200)return m({x:0,y:0}),void T({x:0,y:0});k(a),F({x:t,y:n})}},N=function(e){var t=e.x,n=e.y;i||(console.log("move"),F({x:t,y:n}))},R=function(){i||c&&(console.log("end"),m({x:0,y:0}),T({x:0,y:0}))};return Object(K.jsxs)("div",{className:_e()("joytick",{"enabled-x":l,"enabled-y":u}),onTouchStart:function(e){var t=Object(Le.a)(e.targetTouches,1)[0],n=t.clientX,a=t.clientY;!L&&E("touch"),"mouse"!==L&&M({x:n,y:a})},onTouchMove:function(e){var t=Object(Le.a)(e.targetTouches,1)[0],n=t.clientX,a=t.clientY;"mouse"!==L&&N({x:n,y:a})},onTouchEnd:function(){"mouse"!==L&&R()},ref:j,onMouseDown:function(e){var t=e.clientX,n=e.clientY;!L&&E("mouse"),"touch"!==L&&(g(!0),M({x:t,y:n}))},onMouseMove:function(e){var t=e.clientX,n=e.clientY;"touch"!==L&&x&&N({x:t,y:n})},onMouseUp:function(){"touch"!==L&&(g(!1),R())},children:[Object(K.jsx)("div",{ref:h,className:"rail"}),Object(K.jsx)("div",{className:"handle",style:{right:"".concat(50*(f.x+1),"%"),bottom:"".concat(50*(f.y+1),"%"),transform:"translate(50%, 50%)"},children:n})]})}var He=n(208),Je=n.n(He),Ye=n(209),Xe=n(169),Ze=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(){var e,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=a.useWorker,i=a.workerFile,s=a.sessionId,r=a.url;return Object(j.a)(this,n),(e=t.call(this)).shiftFrame=function(){if(e.running){if(e.framesList.length>30){console.log("Dropping frames",e.framesList.length);var t=e.framesList.findIndex((function(e){return 7===(31&e[4])}));t>=0&&(e.framesList=e.framesList.slice(t))}var n=e.framesList.shift();e.emit("frame_shift",e.framesList.length),n&&e.AvcPlayer.decode(n),requestAnimationFrame(e.shiftFrame)}},e.now=(new Date).getTime(),e.url=r,e.AvcPlayer=new Je.a({useWorker:c,workerFile:i,size:{width:640,height:368}}),e.width=1280,e.height=1024,e.AvcPlayer.onPictureDecoded=function(t,n,a){n===e.width&&a===e.height||(e.emit("resized",{width:n,height:a}),e.width=n,e.height=a)},e.ws=void 0,e.pktnum=0,e.framesList=[],e.running=!1,e.shiftFrameTimeout=null,e.sessionId=s,e._messageHandle=e.messageHandle.bind(Object(b.a)(e)),e}return Object(h.a)(n,[{key:"connectWs",value:function(e){var t=this,n=this.url;return void 0!==this.ws&&(this.ws.close(),delete this.ws),this.ws=new WebSocket("".concat("https:"===window.location.protocol?"wss://":"ws://").concat(n)),this.ws.binaryType="arraybuffer",this.ws.addEventListener("open",(function(){console.log("Connected to "+n),t.emit("connected",n),t.send("get-info",{sessionId:t.sessionId}),t.send("open-request",Object(o.a)({sessionId:t.sessionId},e))})),this.ws.addEventListener("message",(function(e){t._messageHandle(e)})),this.framesList=[],this.ws.onclose=function(){t.emit("disconnected"),console.log("Player: Websocket Connection closed")},this.ws}},{key:"setRTCDataChannel",value:function(e){var t,n;this.rtcDataChannel=e,e.addEventListener("message",this._messageHandle),this.emit("connected"),null===(t=this.ws)||void 0===t||null===(n=t.close)||void 0===n||n.call(t),this.send("get-info",{sessionId:this.sessionId}),this.opening&&this.send("open-request",Object(o.a)({sessionId:this.sessionId},this.config))}},{key:"removeRTCDataChannel",value:function(){this.send("close"),this.rtcDataChannel.removeEventListener("message",this._messageHandle)}},{key:"messageHandle",value:function(e){if("string"==typeof e.data){console.log("Camera message received",e);var t=JSON.parse(e.data),n=t.action,a=t.payload;return this.cmd({action:n,payload:a})}this.pktnum++;var c=new Uint8Array(e.data);this.framesList.push(c),this.running||(this.running=!0,clearTimeout(this.shiftFrameTimeout),this.shiftFrameTimeout=null,this.shiftFrameTimeout=Object(Xe.setTimeout)(this.shiftFrame,1))}},{key:"cmd",value:function(e){return"initalize"===e.action?this.emit("initalized",e.payload):this.emit(e.action,e.payload)}},{key:"disconnect",value:function(){this.close()}},{key:"send",value:function(e,t){var n,a;return"open"===(null===(n=this.rtcDataChannel)||void 0===n?void 0:n.readyState)?this.rtcDataChannel.send(JSON.stringify({action:e,payload:t})):(null===(a=this.ws)||void 0===a?void 0:a.readyState)===WebSocket.OPEN&&this.ws.send(JSON.stringify({action:e,payload:t}))}},{key:"open",value:function(e){var t;this.opening=!0,this.config=e,"open"===(null===(t=this.rtcDataChannel)||void 0===t?void 0:t.readyState)?(this.send("get-info",{sessionId:this.sessionId}),this.send("open-request",Object(o.a)(Object(o.a)({sessionId:this.sessionId},this.config),e))):this.connectWs(e)}},{key:"close",value:function(){var e,t;this.opening=!1,this.send("close"),null===(e=this.ws)||void 0===e||null===(t=e.close)||void 0===t||t.call(e),this.AvcPlayer.canvas.remove()}}]),n}(Ye.EventEmitter),Qe=Ze,$e=n(148),et=n(102),tt=n(417),nt=n(418),at=n(419),ct=n(420),it=n(421),st=n(422),rt=ye.a.Option;function ot(e){var t=e.url,n=e.editabled,c=e.size,i=e.onChangeVideoRatio,s=e.onClickFullScreen,r=e.onClickCenterScreen,o=e.session,l=e.rtcChannel,d="camera-".concat(t),u=Object(a.useRef)(null),j=Object(a.useState)(!1),h=Object(Le.a)(j,2),b=h[0],p=h[1],f=Object(a.useState)(!1),m=Object(Le.a)(f,2),x=m[0],y=m[1],w=Object(a.useState)(""),C=Object(Le.a)(w,2),k=C[0],S=C[1],I=Object(a.useState)([]),E=Object(Le.a)(I,2),T=E[0],F=E[1],M=Object(a.useState)(void 0),N=Object(Le.a)(M,2),R=N[0],D=N[1],P=Object(a.useState)(30),V=Object(Le.a)(P,2),z=V[0],A=V[1],_=Object(a.useState)(0),B=Object(Le.a)(_,2),U=B[0],W=B[1],G=Object(a.useState)(!1),q=Object(Le.a)(G,2),H=q[0],J=q[1],Y=Object(a.useState)(!1),X=Object(Le.a)(Y,2),Z=X[0],Q=X[1],$=Object($e.a)((function(){var e=O.a.get(d)||{},n=e.rotate,a=void 0===n?0:n,c=e.enabled,i=void 0===c||c,s=e.inputFormatIndex,r=void 0===s?0:s,l=e.fps,u=void 0===l?30:l,j=e.xFlip,h=void 0!==j&&j,b=e.yFlip,f=void 0!==b&&b;p(i),W(a),D(r),A(u),J(h),Q(f);var m=new Qe({useWorker:!0,workerFile:"".concat("","/Decoder.js"),sessionId:o.id,url:t});return m.on("info",(function(e){var t=e.cameraName,n=e.size,a=(n.width,n.height,e.formatList);S(t),m.cameraName=t,F(a)})),m.on("resized",(function(e){var t=e.width,n=e.height;v.b.success("".concat(m.cameraName," \u4f20\u8f93\u5206\u8fa8\u7387 ").concat(t,"x").concat(n))})),m}));return Object(a.useEffect)((function(){var e=function(e){var t=e.size,n=t.width,a=t.height;i(n/a)};return $.on("info",e),function(){$.off("info",e)}}),[i,$]),Object(et.a)((function(){$.close()})),Object(Re.a)("visibilitychange",(function(){"visible"===document.visibilityState?y(!1):y(!0)}),{dom:document}),Object(tt.a)((function(){var e=u.current;!x&&b?($.open({inputFormatIndex:R,fps:z,size:c}),$.AvcPlayer.canvas.style.display="",$.AvcPlayer.canvas.parentElement!==e&&e.appendChild($.AvcPlayer.canvas)):($.close(),$.AvcPlayer.canvas.style.display="none")}),[b,x,$,R,z,c],{wait:500}),Object(a.useEffect)((function(){O.a.set(d,{rotate:U,enabled:b,inputFormatIndex:R})}),[d,U,b,R]),Object(a.useEffect)((function(){if(l)return $.setRTCDataChannel(l),function(){return $.removeRTCDataChannel(l)}}),[l,$]),Object(K.jsxs)("div",{className:"camera",children:[n?Object(K.jsxs)("div",{className:"button-box transition-animation",title:k,children:[Object(K.jsx)(L.a,{size:"small",checked:b,onChange:p}),Object(K.jsx)(g.a,{size:"small",shape:"circle",icon:Object(K.jsx)(nt.a,{}),onClick:r}),Object(K.jsx)(g.a,{size:"small",shape:"circle",icon:Object(K.jsx)(at.a,{}),onClick:s}),Object(K.jsx)(g.a,{size:"small",shape:"circle",icon:Object(K.jsx)(ct.a,{}),onClick:function(){W(270===U?0:U+90)}}),Object(K.jsx)(g.a,{size:"small",shape:"circle",icon:Object(K.jsx)(it.a,{}),onClick:function(){J(!H)}}),Object(K.jsx)(g.a,{size:"small",shape:"circle",icon:Object(K.jsx)(st.a,{}),onClick:function(){Q(!Z)}}),Object(K.jsx)(ye.a,{defaultValue:R,onChange:D,size:"small",children:T.map((function(e,t){var n=e.format,a=e.size;return Object(K.jsx)(rt,{value:t,children:"".concat(a," ").concat(n)},a+n)}))}),Object(K.jsxs)(ye.a,{defaultValue:z,onChange:A,size:"small",children:[Object(K.jsx)(rt,{value:15,children:"15 fps"}),Object(K.jsx)(rt,{value:30,children:"30 fps"}),Object(K.jsx)(rt,{value:60,children:"60 fps"})]})]}):void 0,Object(K.jsx)("div",{className:"camera-box",ref:u,style:{transform:"rotate(".concat(U,"deg) scaleX(").concat(H?-1:1,") scaleY(").concat(Z?-1:1,")")}})]})}var lt=n(211),dt=(n(347),n(103)),ut=["onChange","vertical"];function jt(e){var t=e.onChange,n=e.vertical,a=Object(dt.a)(e,ut);return Object(K.jsx)(qe,Object(o.a)({onChange:function(e){var a=e.x,c=e.y;t(n?c:a)},enabledX:!n,enabledY:n},a))}var ht=n(119),bt=n(162),pt=n.n(bt);function ft(e){var t=e.editabled,n=void 0!==t&&t,c=e.statusInfo,i=(c=void 0===c?{}:c).gps,s=Object(a.useState)(O.a.get("gps history")||[]),r=Object(Le.a)(s,2),o=r[0],l=r[1],d=o.length?o[o.length-1]:[117.2,34.2],u=Object(Le.a)(d,2),j=u[0],h=u[1],b=i||{},p=b.lat,f=void 0===p?h:p,m=b.lng,v=void 0===m?j:m,x=[v,f],y=Object(a.useState)(O.a.get("map enabled")),w=Object(Le.a)(y,2),k=w[0],S=w[1],E=Object(a.useState)(O.a.get("map zoom")||15),T=Object(Le.a)(E,2),F=T[0],M=T[1];return Object(a.useEffect)((function(){console.log("GPS",{lat:f,lng:v}),console.log("history",o);var e=o.length;if(0===e||v!==o[e-1][0]||f!==o[e-1][1]){var t=[].concat(Object(Ee.a)(o),[[v,f]]).filter((function(e){var t=Object(Le.a)(e,2),n=t[0];return void 0!==t[1]&&void 0!==n})).slice(0,1e3);console.log("newHistory",t),l(t),O.a.set("gps history",t)}}),[f,v,o]),Object(a.useEffect)((function(){O.a.set("map enabled",k)}),[k]),Object(a.useEffect)((function(){O.a.set("map zoom",F)}),[F]),Object(K.jsxs)("div",{className:pt.a.mapContainer,children:[n?Object(K.jsx)("div",{className:pt.a.editor,children:Object(K.jsxs)(I.b,{size:"small",align:"center",gutter:8,children:[Object(K.jsx)(L.a,{onChange:S,checked:k}),Object(K.jsx)(g.a,{onClick:function(){return l([])},children:"\u6e05\u7a7a"})]})}):null,k&&Object(K.jsxs)(K.Fragment,{children:[Object(K.jsx)(C.a,{className:pt.a.zoom,min:2,max:20,value:F,onChange:function(e){return M(e)}}),Object(K.jsxs)(ht.a,{zoom:F,center:x,children:[Object(K.jsx)(ht.b,{position:x,label:{direction:"bottom"},draggable:!0}),Object(K.jsx)(ht.c,{path:o})]})]})]})}ht.d.key="8faf092bfa96e5b6748ea7e0a2d6ac9c";var mt=n(107),Ot=n(151),vt=Object(Ot.b)({name:"ui",initialState:{positionMap:O.a.get("ui-position")||{},orientation:"landscape"},reducers:{setOrientation:function(e,t){return Object(o.a)(Object(o.a)({},e),{},{orientation:t.payload})},updatePositionMap:function(e,t){var n,a=e.orientation,c=t.payload,i=c.id,s=c.position,l=null===(n=e.positionMap[i])||void 0===n?void 0:n[a],d=Object(o.a)(Object(o.a)({},e),{},{positionMap:Object(o.a)(Object(o.a)({},e.positionMap),{},Object(r.a)({},i,Object(o.a)(Object(o.a)({},e.positionMap[i]),{},Object(r.a)({},a,Object(o.a)(Object(o.a)({},l),s)))))});return O.a.set("ui-position",d.positionMap),d}}}),xt=vt.actions,gt=xt.updatePositionMap,yt=xt.setOrientation,wt=vt.reducer,Ct=window.matchMedia("(orientation: portrait)");function kt(e){var t=e.uiComponentList,n=void 0===t?[]:t,a=e.channelList,c=e.changeChannel,i=void 0===c?function(){}:c,s=e.editabled,r=e.cameraList,l=e.setting,d=e.isShowButton,u=(e.channelStatus,e.statusInfo),j=e.session,h=e.webrtcChannel,b=Object(mt.c)((function(e){return e.ui.positionMap})),p=Object(mt.c)((function(e){return e.ui.orientation})),f=Object(mt.b)();Object($e.a)((function(){f(yt(Ct.matches?"portrait":"landscape"))})),Object(Re.a)("change",(function(e){var t=e.matches;f(yt(t?"portrait":"landscape"))}),{target:Ct});var m=function(e,t){a.forEach((function(n){var a=n.enabled,c=n.ui,s=void 0===c?[]:c,r=n.pin;a&&s.forEach((function(n){var a=n.id,c=n.positive,s=n.axis;e===a&&i({pin:r,value:(c?1:-1)*(s?t[s]:t)})}))}))},O=[].concat(Object(Ee.a)(r.map((function(e){return e.id="camera-".concat(e.cameraIndex),e.type="camera",e.cameraIndex=e.index,e.enabled=!0,e}))),[{id:"map",type:"map",x:80,y:80,enabled:!0}],Object(Ee.a)(d?n:[]));return Object(K.jsx)(K.Fragment,{children:O.map((function(e,t){var n,a=e.id,c=null===(n=b[a])||void 0===n?void 0:n[p];return Object(K.jsx)(Lt,Object(o.a)({statusInfo:u,index:t,editabled:s,session:j,webrtcChannel:h,onControl:m,setting:l,onPositionChange:function(e){return f(gt({orientation:p,id:a,position:e}))},position:c},e),e.id)}))})}var St,It,Lt=function(e){var t,n=e.id,c=e.name,i=e.enabled,s=e.type,r=e.autoReset,l=e.cameraIndex,d=e.vertical,u=e.index,j=e.position,h=void 0===j?{}:j,b=e.onPositionChange,p=e.editabled,f=e.onControl,m=e.session,O=e.webrtcChannel,v=e.setting,x=e.statusInfo,g=h.x,y=void 0===g?50+60*u:g,w=h.y,C=void 0===w?50+60*u:w,k=h.z,S=void 0===k?u+2:k,I=h.videoRate,L=void 0===I?4/3:I,E=h.ratio,T=h.size,F=void 0===T?"map"===s?{width:300,height:300}:void 0:T,M=Object(a.useCallback)((function(e){e!==E&&b({ratio:e})}),[E,b]),N=Object(a.useCallback)((function(e){var t=window.innerWidth,n=t/L,a=(window.innerHeight-n)/2;b(Object(o.a)(Object(o.a)({},h),{},{x:0,y:a,z:0,size:{width:t,height:n}}))}),[b,L,h]),R=Object(a.useCallback)((function(e){var t=window.innerHeight/4,n=t*L;b(Object(o.a)(Object(o.a)({},h),{},{size:{width:n,height:t},x:(window.innerWidth-n)/2,y:-38,z:2}))}),[b,h,L]),D=Object(a.useCallback)((function(e,t){var n=t.x,a=t.y;b({x:n,y:a})}),[b]);return i?Object(K.jsxs)(lt.a,{disableDragging:!p,enableResizing:{top:p,right:p,bottom:p,left:p,topRight:p,bottomRight:p,bottomLeft:p,topLeft:p},className:_e()("ui-rnd",{disabled:!p,resized:F}),lockAspectRatio:void 0===E||E,position:{x:y,y:C},size:F,onDragStop:D,onResizeStop:function(e,t,n,a,c){var i=c.x,s=c.y,r={width:n.offsetWidth,height:n.offsetHeight};b({x:i,y:s,z:S,size:r})},style:{zIndex:null!==(t=null===h||void 0===h?void 0:h.z)&&void 0!==t?t:u+2},children:["joystick"===s&&Object(K.jsx)(qe,{disabled:p,name:c,onChange:function(e){return f(n,e)},autoReset:r,position:h}),"slider"===s&&Object(K.jsx)(jt,{vertical:d,disabled:p,name:c,onChange:function(e){return f(n,e)},autoReset:r,position:h}),"camera"===s&&Object(K.jsx)(ot,{session:m,editabled:p,cameraIndex:"camera"+l,index:l,url:v.host&&"".concat(v.host,"/video").concat(l),onChangeVideoRatio:function(e){return M(e)},onClickFullScreen:function(){return N(n)},onClickCenterScreen:function(){return R(n)},size:F,rtcChannel:O[c]},"camera"+l),"map"===s&&Object(K.jsx)(ft,{editabled:p,statusInfo:x})]},"rnd-".concat(n)):null},Et=n(383),Tt=n(404),Ft=Object(Tt.a)({scriptUrl:"//at.alicdn.com/t/font_1773709_52px07fzrwt.js"}),Mt=ye.a.Option,Nt={};function Rt(e){var t=e.channelList,n=void 0===t?[]:t,c=e.changeChannel,i=void 0===c?function(){}:c,s=e.channelStatus,r=void 0===s?{}:s,o=e.playAudio,l=e.serverConfig.audioList,d=Object(a.useState)(!1),u=Object(Le.a)(d,2),j=u[0],h=u[1],b=Object(a.useState)([]),p=Object(Le.a)(b,2),f=p[0],m=p[1],O=Object(a.useState)(void 0),x=Object(Le.a)(O,2),y=x[0],w=x[1];return Object(Et.a)((function(){for(var e=[],t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[],n=0;n<t.length;n++){var a=t[n];a&&(e.push(a),y||(w(a),h(!0)))}m([].concat(e))})),Object(Re.a)("gamepadconnected",(function(e){var t=e.gamepad,n=t.index,a=t.id;v.b.success("\u63a7\u5236\u5668\u5df2\u8fde\u63a5\u4e8e ".concat(n," \u4f4d: ").concat(a,"\u3002")),f.push(t),m(Object(Ee.a)(f)),w(t),h(!0)})),Object(Re.a)("gamepadchange",(function(e){var t=e.detail,a=t.buttons,c=t.axes;n.forEach((function(e){var t=e.gamepad,n=void 0===t?[]:t,s=e.pin,o=e.type;n.forEach((function(e){var t=e.name,n=(e.method,e.speed),l=t.split("-"),d=Object(Le.a)(l,2),u=d[0],j=d[1],h="button"===u?a[j-0].value:c[j-0];if(Nt[t]!==h){switch(Nt[t]=h,u){case"button":if("switch"===o){if(!(h>0))return;h=!r[s]}else h=n*a[j-0].value;break;case"axis":h=n*c[j-0];break;default:return}i({pin:s,value:h})}}))}))})),Object(Re.a)("gamepadpress",(function(e){var t=e.detail,n=t.index;t.value<1||l.forEach((function(e){var t=e.path,a=e.gamepadButton,c=e.text,i=e.type;if(void 0!==a&&null!==a&&a-0===n-0)switch(i){case"audio":o({path:t});break;case"text":o({text:c});break;case"stop":o({stop:!0})}}))})),Object(a.useEffect)((function(){return j&&y?function(e){var t=e.index;St=setInterval((function(){var e=(navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[])[t];if(e){var n=e.connected,a=e.timestamp;n&&It!==a&&(It=a,window.dispatchEvent(new CustomEvent("gamepadchange",{detail:e})),e.buttons.forEach((function(e,t){var n=e.value;Nt["button-".concat(t)]!==n&&(Nt["button-".concat(t)]=n,window.dispatchEvent(new CustomEvent("gamepadpress",{detail:{index:t,value:n}})))})))}}),10)}(y):clearInterval(St),function(){St&&clearInterval(St)}}),[j,y]),Object(K.jsxs)(I.b,{children:[Object(K.jsx)(L.a,{checked:j,onChange:h,unCheckedChildren:Object(K.jsx)(Ft,{type:"icon-game-"}),checkedChildren:Object(K.jsx)(Ft,{type:"icon-game-"})}),f.length>1&&Object(K.jsx)(k.a,{placement:"topLeft",content:Object(K.jsx)(ye.a,{value:y&&y.id,onChange:function(e){return w(f.find((function(t){return t.id===e})))},children:f.map((function(e){return Object(K.jsx)(Mt,{value:e.id,children:e.id},e.id)}))}),children:Object(K.jsx)(g.a,{shape:"round",children:"\u9009\u62e9\u624b\u67c4"})})]})}var Dt,Pt=n(384);function Vt(e){var t=e.serverConfig,n=(t=void 0===t?{}:t).channelList,c=void 0===n?[]:n,i=e.changeChannel,s=Object(a.useState)(!1),r=Object(Le.a)(s,2),l=r[0],d=r[1],u=Object(a.useState)(void 0),j=Object(Le.a)(u,2),h=j[0],b=j[1],p=Object(a.useState)(!1),f=Object(Le.a)(p,2),m=f[0],O=f[1],x=Object(Pt.a)((function(e){var t=e.alpha,n=e.beta,a=e.gamma;l&&(!m&&O(!0),a<20&&a>-20||(a<0&&(t=t>180?t-180:t+180),Dt={alpha:t,beta:n,gamma:a},h&&c.forEach((function(e){var t=e.pin,n=e.orientation,a=(n=void 0===n?{}:n).coefficient,c=void 0===a?1:a,s=n.axis;if(c&&s){var r=Dt[s="x"===s?"alpha":"gamma"]-h[s];"x"===s&&Math.abs(r)>Math.abs(360-r)&&(r-=360),"gamma"===s&&Math.abs(r)>Math.abs(180-r)&&(r-=180);i({pin:t,value:(r=(r=r<-90?-90:r)>90?90:r)/90*c})}}))))}),{wait:50}).run;return Object(Re.a)("deviceorientation",x),Object(tt.a)((function(){l&&m&&(b(Object(o.a)({},Dt)),v.b.success("\u5df2\u6821\u51c6\u91cd\u529b"))}),[l,m],{wait:100}),Object(K.jsx)(L.a,{checked:l,checkedChildren:"\u91cd\u529b",unCheckedChildren:"\u91cd\u529b",onChange:function(e){!0===e&&!m&&DeviceMotionEvent&&"function"===typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then((function(e){"granted"===e&&(d(!0),O(!0),v.b.success("\u5df2\u83b7\u5f97\u91cd\u529b\u611f\u5e94\u6743\u9650"))})).catch((function(e){d(!1),v.b.warn("\u6ca1\u6709\u6743\u9650",e)})):d(e)},children:"\u91cd\u529b"})}var zt=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var c;return Object(j.a)(this,n),(c=t.call(this,e)).fixContent=function(){var e=c.props,t=e.serverConfig,n=t.channelList,a=void 0===n?[]:n,i=t.specialChannel,s=void 0===i?{}:i,r=e.saveServerConfig,o=a.find((function(e){return e.id===s.direction}));return Object(K.jsx)(w.a,{children:o&&Object(K.jsx)(w.a.Item,{label:"\u8235\u673a\u5fae\u8c03",children:Object(K.jsx)(C.a,{defaultValue:50*o.valueReset+50,min:0,max:100,included:!1,onChange:function(e){o.valueReset=e/50-1,r({channelList:a})},style:{width:"50vw"}})})})},c.ttsInput=Object(a.createRef)(),c.state={text:"",zeroOrientation:void 0,isShowButton:O.a.get("is-show-button")||!0,ttsInputVisible:!1},c.steeringStatus=[],c}return Object(h.a)(n,[{key:"onControl",value:function(){}},{key:"render",value:function(){var e=this,t=this.fixContent,n=this.ttsInput,a=this.props,c=a.statusInfo,i=a.action,s=a.cameraEnabled,r=a.videoEl,o=a.onTTS,l=a.ttsPlaying,d=a.setting,u=a.playAudio,j=a.serverConfig,h=a.changeChannel,b=a.editabled,p=a.cameraList,f=a.channelStatus,m=a.saveServerConfig,v=a.isFullscreen,x=a.session,D=a.webrtcChannel,P=this.state,V=P.isShowButton,z=P.ttsInputVisible,A=P.text,_=j.channelList,U=void 0===_?[]:_,W=j.specialChannel,G=void 0===W?{}:W,q=U.find((function(e){return e.id===G.speed})),H=j.audioList,J=void 0===H?[]:H;return Object(K.jsxs)("div",{className:"controller",children:[Object(K.jsxs)(y.c,{className:"controller-router",children:[Object(K.jsx)(Ie,{path:"ai/learn/*",canvasRef:r,cameraEnabled:s,action:i,onAi:function(t){return e.setState({isAiControlling:t})}}),Object(K.jsx)(Ne,{path:"ai/coco-ssd/*",videoEl:r,cameraEnabled:s,action:i,onAi:function(t){return e.setState({isAiControlling:t})}})]}),!v&&Object(K.jsxs)(w.a,{className:"controller-form",size:"small",layout:"inline",children:[Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(k.a,{content:t,title:"\u4fee\u6b63",trigger:"click",placement:"topLeft",children:Object(K.jsx)(g.a,{icon:Object(K.jsx)(E.a,{}),children:"\u4fee\u6b63"})})}),q&&Object(K.jsxs)(K.Fragment,{children:[Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(k.a,{placement:"topLeft",content:Object(K.jsx)(C.a,{defaultValue:100*q.valuePostive,min:0,max:100,onChange:function(e){q.valuePostive=e/100,m({channelList:U})},arrowPointAtCenter:!0,style:{width:"30vw"}}),children:Object(K.jsxs)(g.a,{shape:"round",children:["\u524d\u8fdb:",Math.round(100*q.valuePostive)]})})}),Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(k.a,{placement:"topLeft",content:Object(K.jsx)(C.a,{defaultValue:-100*q.valueNegative,min:0,max:100,style:{width:"30vw"},onChange:function(e){q.valueNegative=e/100*-1,m({channelList:U})}}),children:Object(K.jsxs)(g.a,{shape:"round",children:["\u5012\u9000:",Math.round(-100*q.valueNegative)]})})})]}),Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(Rt,{changeChannel:h,channelList:j.channelList,channelStatus:f,playAudio:u,serverConfig:j})}),Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(Vt,{changeChannel:h,channelStatus:f,serverConfig:j})}),Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(B,{playAudio:u,channelStatus:f,channelList:j.channelList,changeChannel:h,serverConfig:j,onEnter:function(){e.setState({ttsInputVisible:!0}),setTimeout((function(){n.current&&n.current.focus()}),200)}})}),Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(k.a,{arrowPointAtCenter:!0,trigger:"click",placement:"topRight",visible:z,onVisibleChange:function(t){e.setState({ttsInputVisible:t}),setTimeout((function(){n.current&&n.current.focus()}),200)},content:Object(K.jsx)("form",{children:Object(K.jsx)(S.a.Search,{ref:n,name:"tts",style:{width:"60vw"},placeholder:"\u53d1\u9001\u8bed\u97f3",enterButton:"\u53d1\u9001",value:A,onChange:function(t){return e.setState({text:t.target.value})},onSearch:function(t){o(t),e.setState({text:""})},loading:l,onKeyDown:function(t){t.stopPropagation(),"Escape"===t.key&&e.setState({ttsInputVisible:!1})}})}),children:Object(K.jsx)(g.a,{shape:"round",children:Object(K.jsx)(T.a,{})})})}),J.filter((function(e){return e.showFooter})).map((function(e){var t=e.path,n=e.text,a=e.name;return Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(g.a,{shape:"round",onClick:function(){return u({path:t,text:n})},icon:Object(K.jsx)(F.a,{}),children:a})},a)})),Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(k.a,{placement:"topRight",content:Object(K.jsxs)(I.b,{size:[16,16],wrap:!0,children:[Object(K.jsx)(w.a.Item,{extra:"\u663e\u793a\u89e6\u63a7 UI",children:Object(K.jsx)(L.a,{checked:V,onChange:function(t){O.a.set("is-show-button",t),e.setState({isShowButton:t})},checkedChildren:Object(K.jsx)(M.a,{}),unCheckedChildren:Object(K.jsx)(M.a,{})})}),J.filter((function(e){return!e.showFooter})).map((function(e){var t=e.path,n=e.text,a=e.name,c=e.type;return Object(K.jsxs)(w.a.Item,{extra:"\u64ad\u653e".concat(a),children:["audio"===c&&Object(K.jsx)(g.a,{shape:"round",onClick:function(){return u({path:t})},icon:Object(K.jsx)(F.a,{}),children:a}),"text"===c&&Object(K.jsx)(g.a,{shape:"round",onClick:function(){return u({text:n})},icon:Object(K.jsx)(F.a,{}),children:a}),"stop"===c&&Object(K.jsx)(g.a,{shape:"round",onClick:function(){return u({stop:!0})},icon:Object(K.jsx)(N.a,{}),children:a})]},a)}))]}),children:Object(K.jsx)(g.a,{shape:"round",children:Object(K.jsx)(R.a,{})})})}),Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(Ke,{url:d.host&&"".concat("https:"===window.location.protocol?"wss://":"ws://").concat(d.host,"/audio")})})]}),Object(K.jsx)(kt,{webrtcChannel:D,session:x,channelStatus:f,isShowButton:V,uiComponentList:j.uiComponentList,channelList:j.channelList,changeChannel:h,editabled:b,cameraList:p,setting:d,isFullscreen:v,statusInfo:c})]})}}]),n}(a.Component),Kt=n(175),At=n(100),_t=n(214),Bt=n.n(_t),Ut=n(129),Wt=n.n(Ut),Gt=n(210);var qt=function(e){var t=e.saveServerConfig,n=e.sharedCode,a=e.sharedDuration,c=void 0===a?6e5:a,i=e.sharedEndTime,s=e.wsConnected,r=n?"".concat(window.location.origin,"/login?shared-code=").concat(n):"",l=function(){r&&(Wt()(r),v.b.success("\u5206\u4eab\u5730\u5740\u5df2\u590d\u5236 \ud83e\udd29 \uff01"))};return Object(Gt.a)(l,[n]),Object(K.jsxs)(w.a,Object(o.a)(Object(o.a)({},re),{},{children:[Object(K.jsx)(w.a.Item,{label:"\u5f00\u542f",children:Object(K.jsx)(L.a,{disabled:!s,checkedChildren:"".concat(i?((i-(new Date).getTime())/1e3).toFixed(0):c/1e3,"s"),onChange:function(e){t({sharedCode:!!e&&Object(At.uuid)()})},checked:!!n})}),Object(K.jsxs)(w.a.Item,{label:"\u5206\u4eab\u65f6\u95f4",children:[Object(K.jsx)(G.a,{min:60,defaultValue:c/1e3,step:60,onChange:function(e){isNaN(1e3*e)||t({sharedDuration:1e3*e})}}),"\u79d2"]}),Object(K.jsx)(w.a.Item,{label:"\u5206\u4eab\u63a7\u5236\u5730\u5740",children:Object(K.jsx)(S.a,{disabled:!0,value:r,suffix:r?Object(K.jsx)(g.a,{type:"link",onClick:l,children:"\u590d\u5236"}):void 0})}),Object(K.jsx)(w.a.Item,{label:"\u5206\u4eab\u4e8c\u7ef4\u7801",children:Object(K.jsx)(Bt.a,{value:r||"https://blog.esonwong.com/donate/"})})]}))},Ht=n(108),Jt=n(428),Yt=n(226),Xt=ye.a.Option,Zt=[{label:"\u6447\u6746",value:"joystick"},{label:"\u6ed1\u6746",value:"slider"}];function Qt(e){var t=e.saveServerConfig,n=e.serverConfig,a=w.a.useForm(),c=Object(Le.a)(a,1)[0];return Object(K.jsxs)(w.a,{form:c,onFinish:t,initialValues:n,children:[Object(K.jsx)(w.a.List,{name:"uiComponentList",children:function(e,t){var n=t.add,a=t.remove;return Object(K.jsxs)(K.Fragment,{children:[e.map((function(e){return Object(K.jsx)(Ht.a,{children:Object(K.jsxs)(I.b,{align:"baseline",children:[Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},e),{},{name:[e.name,"enabled"],fieldKey:[e.fieldKey,"enabled"],valuePropName:"checked",children:Object(K.jsx)(L.a,{checkedChildren:"\u663e\u793a",unCheckedChildren:"\u9690\u85cf"})})),Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},e),{},{label:"\u540d\u79f0",name:[e.name,"name"],fieldKey:[e.fieldKey,"name"],children:Object(K.jsx)(S.a,{style:{width:80}})})),Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},e),{},{label:"\u7c7b\u578b",name:[e.name,"type"],fieldKey:[e.fieldKey,"type"],rules:[{required:!0,message:"\u4f60\u8fd8\u6ca1\u9009"}],children:Object(K.jsx)(ye.a,{style:{width:72},children:Zt.map((function(e){var t=e.value,n=e.label;return Object(K.jsx)(Xt,{value:t,children:n},t)}))})})),Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},e),{},{label:"\u91ca\u653e\u5f52\u4f4d",name:[e.name,"autoReset"],fieldKey:[e.fieldKey,"autoReset"],valuePropName:"checked",extra:"\u91ca\u653e UI \u63a7\u4ef6\u662f\u5426\u81ea\u52a8\u5f52\u4f4d",children:Object(K.jsx)(L.a,{})})),"slider"===c.getFieldValue(["uiComponentList",e.fieldKey,"type"])&&Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},e),{},{label:"\u65b9\u5411",name:[e.name,"vertical"],fieldKey:[e.fieldKey,"vertical"],shouldUpdate:!0,rules:[{required:!0,message:"\u4f60\u8fd8\u6ca1\u9009"}],children:Object(K.jsxs)(ye.a,{style:{width:80},children:[Object(K.jsx)(Xt,{value:!1,children:" \u6a2a\u5411 "}),Object(K.jsx)(Xt,{value:!0,children:" \u5782\u76f4 "})]})})),Object(K.jsx)(Jt.a,{onClick:function(){return a(e.name)}})]},e.key)})})),Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(g.a,{type:"dashed",onClick:function(){return n({id:Object(At.uuid)(),enabled:!0})},block:!0,icon:Object(K.jsx)(Yt.a,{}),children:"\u6dfb\u52a0\u63a7\u5236\u7ec4\u4ef6"})})]})}}),Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(g.a,{type:"primary",htmlType:"submit",children:"\u4fdd\u5b58"})})]})}for(var $t=n(396),en=n(385),tn=n(429),nn=n(224),an=ye.a.Option,cn=$t.a.Panel,sn=[],rn=0;rn<27;rn++)sn.push(rn+1);for(var on=[{label:"PWM",value:"pwm"},{label:"\u7535\u5e73",value:"switch"}],ln=[],dn=0;dn<8;dn++)ln.push({value:"axis-".concat(dn),name:"AXIS ".concat(dn)});for(var un=0;un<28;un++)ln.push({value:"button-".concat(un),name:"B".concat(un)});function jn(e){var t=e.saveServerConfig,n=e.serverConfig,c=e.resetChannel,i=w.a.useForm(),s=Object(Le.a)(i,1)[0];Object(a.useEffect)((function(){s.resetFields()}),[n,s]);var r=function(e,t,a){var c=a.add,i=a.remove;return Object(K.jsxs)(I.b,{align:"baseline",split:Object(K.jsx)(en.a,{type:"vertical"}),wrap:!0,children:[t.map((function(t){var a=s.getFieldValue(["channelList",e,"ui",t.name,"id"]),c=n.uiComponentList.find((function(e){return e.id===a}));return Object(K.jsxs)(I.b,{align:"baseline",children:[Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({label:"UI"},t),{},{name:[t.name,"id"],fieldKey:[t.fieldKey,"id"],rules:[{required:!0,message:"\u5ba2\u5b98\uff01\u9009\u4e00\u4e2a\uff01"}],children:Object(K.jsx)(ye.a,{style:{width:80},children:n.uiComponentList.map((function(e){var t=e.id,n=e.name;return Object(K.jsxs)(an,{value:t,children:[" ",n," "]})}))})})),c&&"joystick"===c.type&&Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({label:"\u8f74"},t),{},{name:[t.name,"axis"],fieldKey:[t.fieldKey,"axis"],rules:[{required:!0,message:"\u5ba2\u5b98\uff01\u9009\u4e00\u4e2a\uff01"}],children:Object(K.jsxs)(ye.a,{style:{width:80},children:[Object(K.jsx)(an,{value:"x",children:"x"}),Object(K.jsx)(an,{value:"y",children:"y"})]})})),Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({label:"\u63a7\u5236\u65b9\u5411"},t),{},{name:[t.name,"positive"],fieldKey:[t.fieldKey,"positive"],valuePropName:"checked",children:Object(K.jsx)(L.a,{checkedChildren:"\u6b63\u5411",unCheckedChildren:"\u53cd\u5411"})})),Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({label:"\u63a7\u5236\u65b9\u5f0f"},t),{},{name:[t.name,"method"],fieldKey:[t.fieldKey,"method"],children:Object(K.jsxs)(ye.a,{style:{width:80},children:[Object(K.jsx)(an,{value:"default",children:"\u9ed8\u8ba4"}),Object(K.jsx)(an,{value:"step",children:"\u6b65\u8fdb"})]})})),Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({label:"\u6b65\u8fdb\u901f\u5ea6"},t),{},{name:[t.name,"speed"],fieldKey:[t.fieldKey,"speed"],initialValue:.5,children:Object(K.jsx)(G.a,{step:.1,min:0,disabled:"step"!==s.getFieldValue(["channelList",e,"ui",t.name,"method"])})})),Object(K.jsx)(Jt.a,{onClick:function(){return i(t.name)}})]},t.key)})),Object(K.jsx)(tn.a,{onClick:function(){return c({positive:!0,method:"default"})}})]})},l=function(e,t,n){var a=n.add,c=n.remove,i=s.getFieldValue(["channelList",e,"type"]);return Object(K.jsxs)(I.b,{align:"baseline",direction:"vertical",children:[t.map((function(t){var n=s.getFieldValue(["channelList",e,"keyboard",t.name,"method"]);return Object(K.jsxs)(I.b,{align:"baseline",children:[Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},t),{},{name:[t.name,"name"],fieldKey:[t.fieldKey,"name"],rules:[{required:!0,message:"\u5ba2\u5b98\uff01\u9009\u4e00\u4e2a\u6309\u952e\uff01"}],extra:"\u952e\u76d8\u6309\u952e",children:Object(K.jsx)(S.a,{style:{width:80}})})),"pwm"===i&&Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},t),{},{name:[t.name,"method"],fieldKey:[t.fieldKey,"method"],defaultValue:"default",extra:"\u63a7\u5236\u65b9\u5f0f",children:Object(K.jsxs)(Me.a.Group,{size:"middle",children:[Object(K.jsx)(Me.a.Button,{value:"default",children:"\u9ed8\u8ba4"}),Object(K.jsx)(Me.a.Button,{value:"step",children:"\u6b65\u8fdb"})]})})),"pwm"===i&&Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},t),{},{name:[t.name,"speed"],fieldKey:[t.fieldKey,"speed"],extra:"default"===n?"-1 ~ 1\uff0c 0 \u4e3a\u5f52\u4f4d":"\u6bcf\u79d2\u6b65\u8fdb\u901f\u5ea6\u7cfb\u6570",children:Object(K.jsx)(G.a,{max:1,min:-1,step:.1})})),("default"===n||"switch"===i)&&Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},t),{},{name:[t.name,"autoReset"],fieldKey:[t.fieldKey,"autoReset"],extra:"\u91ca\u653e\u952e\u76d8\u662f\u5426\u590d\u4f4d",valuePropName:"checked",defaultValue:!0,children:Object(K.jsx)(L.a,{})})),Object(K.jsx)(Jt.a,{onClick:function(){return c(t.name)}})]},t.key)})),Object(K.jsx)(tn.a,{onClick:function(){return a({speed:1,autoReset:!0,method:"default"})}})]})},d=function(e,t,n){var a=n.add,c=n.remove,i=s.getFieldValue(["channelList",e,"type"]);return Object(K.jsxs)(I.b,{align:"baseline",split:Object(K.jsx)(en.a,{type:"vertical"}),wrap:!0,children:[t.map((function(e){return Object(K.jsxs)(I.b,{align:"baseline",children:[Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},e),{},{name:[e.name,"name"],fieldKey:[e.fieldKey,"name"],rules:[{required:!0,message:"\u5ba2\u5b98\uff01\u9009\u4e00\u4e2a\uff01"}],extra:"\u6447\u6746\u8f74\u6216\u6309\u952e",children:Object(K.jsx)(ye.a,{style:{width:100},children:ln.map((function(e){var t=e.value,n=e.name;return Object(K.jsxs)(an,{value:t,children:[" ",n," "]})}))})})),"pwm"===i&&Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},e),{},{name:[e.name,"method"],fieldKey:[e.fieldKey,"method"],defaultValue:"default",extra:"\u63a7\u5236\u65b9\u5f0f",children:Object(K.jsxs)(Me.a.Group,{size:"middle",children:[Object(K.jsx)(Me.a.Button,{value:"default",children:"\u9ed8\u8ba4"}),Object(K.jsx)(Me.a.Button,{value:"step",children:"\u6b65\u8fdb"})]})})),"pwm"===i&&Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},e),{},{name:[e.name,"speed"],fieldKey:[e.fieldKey,"speed"],extra:"\u63a7\u5236\u7cfb\u6570\uff0c-1 ~ 1",children:Object(K.jsx)(G.a,{min:-1,max:1,step:.1})})),Object(K.jsx)(Jt.a,{onClick:function(){return c(e.name)}})]},e.key)})),Object(K.jsx)(tn.a,{onClick:function(){return a({speed:1,autoReset:!0,method:"default"})}})]})};return Object(K.jsxs)(w.a,{form:s,onFinish:t,initialValues:n,children:[Object(K.jsx)(w.a.List,{name:"channelList",children:function(e,t){var n=t.add,a=t.remove;return Object(K.jsxs)(I.b,{direction:"vertical",style:{width:"100%"},children:[e.map((function(e){return Object(K.jsxs)(ie.a,{title:Object(K.jsxs)(I.b,{align:"baseline",wrap:!0,children:[Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},e),{},{name:[e.name,"enabled"],fieldKey:[e.fieldKey,"enabled"],valuePropName:"checked",children:Object(K.jsx)(L.a,{checkedChildren:"\u5f00\u542f",unCheckedChildren:"\u7981\u7528"})})),Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},e),{},{label:"\u540d\u79f0",name:[e.name,"name"],fieldKey:[e.fieldKey,"name"],children:Object(K.jsx)(S.a,{style:{width:80}})})),Object(K.jsx)(g.a,{danger:!0,onClick:function(){return a(e.name)},children:Object(K.jsx)(nn.a,{})})]},e.key),children:[Object(K.jsx)(Ht.a,{children:Object(K.jsxs)(I.b,{align:"baseline",wrap:!0,children:[Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},e),{},{label:"GPIO",name:[e.name,"pin"],fieldKey:[e.fieldKey,"pin"],rules:[{required:!0,message:"\u4ed4\u7ec6\u60f3\u60f3"}],children:Object(K.jsx)(ye.a,{style:{width:60},children:sn.map((function(e){return Object(K.jsx)(an,{value:e,children:e},e)}))})})),Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},e),{},{label:"\u7c7b\u578b",name:[e.name,"type"],fieldKey:[e.fieldKey,"type"],rules:[{required:!0,message:"\u4f60\u4e0d\u80fd\u6ca1\u6709\u6211\uff01"}],children:Object(K.jsx)(ye.a,{style:{width:80},children:on.map((function(e){var t=e.value,n=e.label;return Object(K.jsx)(an,{value:t,children:n},t)}))})})),"pwm"===s.getFieldValue(["channelList",e.fieldKey,"type"])&&Object(K.jsxs)(K.Fragment,{children:[Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},e),{},{label:"\u6700\u5927\u503c",name:[e.name,"valuePostive"],fieldKey:[e.fieldKey,"valuePostive"],children:Object(K.jsx)(G.a,{step:.1,max:2,min:s.getFieldValue(["channelList",e.fieldKey,"valueReset"])})})),Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},e),{},{label:"\u590d\u4f4d\u503c",name:[e.name,"valueReset"],fieldKey:[e.fieldKey,"valueReset"],shouldUpdate:!0,children:Object(K.jsx)(G.a,{step:.1,min:s.getFieldValue(["channelList",e.fieldKey,"valueNegative"]),max:s.getFieldValue(["channelList",e.fieldKey,"valuePostive"])})})),Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},e),{},{label:"\u6700\u5c0f\u503c",name:[e.name,"valueNegative"],fieldKey:[e.fieldKey,"valueNegative"],children:Object(K.jsx)(G.a,{step:.1,min:-2,max:s.getFieldValue(["channelList",e.fieldKey,"valueReset"])})}))]})]},e.key)}),Object(K.jsxs)($t.a,{align:"start",children:[Object(K.jsx)(cn,{header:"UI \u63a7\u4ef6",size:"small",children:Object(K.jsx)(w.a.List,{name:[e.name,"ui"],children:function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return r.apply(void 0,[e.fieldKey].concat(n))}})}),Object(K.jsx)(cn,{header:"\u952e\u76d8",size:"small",children:Object(K.jsx)(w.a.List,{name:[e.name,"keyboard"],children:function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return l.apply(void 0,[e.fieldKey].concat(n))}})}),Object(K.jsx)(cn,{header:"\u624b\u67c4",size:"small",children:Object(K.jsx)(w.a.List,{name:[e.name,"gamepad"],children:function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return d.apply(void 0,[e.fieldKey].concat(n))}})}),Object(K.jsxs)(cn,{header:"\u624b\u673a\u91cd\u529b\u611f\u5e94",size:"small",children:[Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},e),{},{label:"\u65b9\u5411",name:[e.name,"orientation","axis"],fieldKey:[e.fieldKey,"orientation","axis"],children:Object(K.jsx)(ye.a,{style:{width:80},allowClear:!0,children:[{name:"\u6c34\u5e73",value:"x"},{name:"\u5782\u76f4",value:"y"}].map((function(e){return Object(K.jsx)(an,{value:e.value,children:e.name},e.value)}))})})),Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},e),{},{label:"\u7cfb\u6570",name:[e.name,"orientation","coefficient"],fieldKey:[e.fieldKey,"orientation","coefficient"],children:Object(K.jsx)(C.a,{defaultValue:1,max:2,min:-2,step:.01})}))]})]})]},e.key)})),Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(g.a,{onClick:function(){return n({id:Object(At.uuid)(),enabled:!0,valuePostive:1,valueNegative:-1,valueReset:0})},block:!0,icon:Object(K.jsx)(Yt.a,{}),children:"\u6dfb\u52a0\u901a\u9053"})})]},e.key)}}),Object(K.jsx)(w.a.Item,{children:Object(K.jsxs)(I.b,{children:[Object(K.jsx)(g.a,{type:"primary",htmlType:"submit",children:"\u4fdd\u5b58"}),Object(K.jsx)(g.a,{type:"danger",onClick:function(){c(),O.a.remove("ui-position")},children:"\u6062\u590d\u9ed8\u8ba4\u901a\u9053\u8bbe\u7f6e"})]})})]})}var hn=ye.a.Option;function bn(e){var t=e.saveServerConfig,n=e.serverConfig,a=n.channelList,c=void 0===a?[]:a;return Object(K.jsxs)(w.a,Object(o.a)(Object(o.a)({},re),{},{onFinish:t,initialValues:n,children:[Object(K.jsx)(w.a.Item,{label:"\u6cb9\u95e8\u901a\u9053",name:["specialChannel","speed"],extra:"\u81ea\u52a8\u5239\u8f66\u9700\u8981\u6b63\u786e\u8bbe\u7f6e\u6b64\u901a\u9053",children:Object(K.jsx)(ye.a,{children:c.filter((function(e){return"pwm"===e.type})).map((function(e){var t=e.id,n=e.name,a=e.pin;return Object(K.jsxs)(hn,{value:t,children:[" ",n,"(GPIO:",a,")"," "]},t)}))})}),Object(K.jsx)(w.a.Item,{label:"\u65b9\u5411\u901a\u9053",name:["specialChannel","direction"],children:Object(K.jsx)(ye.a,{children:c.filter((function(e){return"pwm"===e.type})).map((function(e){var t=e.id,n=e.name,a=e.pin;return Object(K.jsxs)(hn,{value:t,children:[" ",n,"(GPIO:",a,")"," "]},t)}))})}),Object(K.jsx)(w.a.Item,{label:"\u81ea\u52a8\u5239\u8f66\u5ef6\u8fdf\u9600\u503c",name:"autoLockTime",extra:"\b\u6beb\u79d2\uff0c\u7f51\u7edc\u5ef6\u8fdf\u8d85\u8fc7\u8bbe\u5b9a\u503c\u65f6\u5239\u8f66",children:Object(K.jsx)(C.a,{max:3e3})}),Object(K.jsx)(w.a.Item,{label:"\u5ef6\u8fdf\u5239\u8f66\u65f6\u957f",name:"brakeTime",extra:"\u6beb\u79d2\uff0c\u8bbe\u4e3a 0 \u65f6\u4ec5\u590d\u4f4d\u901a\u9053",children:Object(K.jsx)(C.a,{max:1e3})}),Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},oe),{},{children:Object(K.jsx)(g.a,{type:"primary",htmlType:"submit",children:"\u4fdd\u5b58"})}))]}))}var pn=n(225),fn=n(430),mn=n(431),On=n(215),vn=n.n(On);function xn(e){var t=e.serverConfig,n=e.resetServerConfig,a=e.saveServerConfig,c=e.updateVersion,i=e.updateStaus;return Object(K.jsxs)(w.a,Object(o.a)(Object(o.a)({},re),{},{children:[Object(K.jsx)(w.a.Item,{children:Object(K.jsxs)(I.b,{children:[Object(K.jsx)(g.a,{icon:Object(K.jsx)(pn.a,{}),type:"primary",onClick:function(){var e=new Blob([JSON.stringify(t)],{type:"text/plain;charset=utf-8"});Object(Oe.saveAs)(e,"network-rc-config-backgup-".concat(vn()().format("YYYYMMDDTHHmmss"),".json"))},children:"\u5907\u4efd\u5f53\u524d\u8bbe\u7f6e"}),Object(K.jsx)(ae.a,{accept:".json",beforeUpload:function(e){var t=new FileReader;return t.onload=function(e){t.result&&a(JSON.parse(t.result))},t.onerror=function(e){console.error(e),v.b.error("\u8bfb\u53d6\u5907\u4efd\u9519\u8bef")},t.readAsText(e),!1},showUploadList:!1,children:Object(K.jsx)(g.a,{icon:Object(K.jsx)(fn.a,{}),children:"\u6062\u590d\u5df2\u4fdd\u5b58\u7684\u8bbe\u7f6e"})}),Object(K.jsx)(g.a,{icon:Object(K.jsx)(mn.a,{}),danger:!0,onClick:n,children:"\u6062\u590d\u9ed8\u8ba4\u8bbe\u7f6e\uff08\u6240\u6709\u8bbe\u7f6e\uff09"})]})}),Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(g.a,{onClick:function(e){e.preventDefault(),c()},loading:!!i,children:i||"\u66f4\u65b0\u7248\u672c"})})]}))}var gn=n(391),yn=["key","name"],wn=ye.a.Option,Cn=window.location.protocol;function kn(e){var t=e.micVolume,n=e.audioList,a=e.saveServerConfig,c=e.host,i=w.a.useForm(),s=Object(Le.a)(i,1)[0],r=Object(gn.a)("".concat(Cn,"//").concat(c,"/api/speaker/current"),{onSuccess:function(){s.resetFields()}}).data,l=void 0===r?{}:r,d=Object(gn.a)("".concat(Cn,"//").concat(c,"/api/speaker")).data,u=void 0===d?[]:d,j=Object(gn.a)((function(){return{url:"".concat(Cn,"//").concat(c,"/api/speaker/set"),method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:s.getFieldValue("currentSpeakerName")})}}),{manual:!0}).run,h=Object(gn.a)((function(){return{url:"".concat(Cn,"//").concat(c,"/api/speaker/volume"),method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:s.getFieldValue("currentSpeakerName"),volume:s.getFieldValue("currentSpeakerVolume")})}}),{manual:!0}).run,b=Object(gn.a)("".concat(Cn,"//").concat(c,"/api/mic/current"),{onSuccess:function(){s.resetFields()}}).data,p=void 0===b?{}:b,f=Object(gn.a)("".concat(Cn,"//").concat(c,"/api/mic")).data,m=void 0===f?[]:f,O=Object(gn.a)((function(){return{url:"".concat(Cn,"//").concat(c,"/api/mic/set"),method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:s.getFieldValue("currentMicName")})}}),{manual:!0}).run,v=Object(gn.a)((function(){return{url:"".concat(Cn,"//").concat(c,"/api/mic/volume"),method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:s.getFieldValue("currentMicName"),volume:s.getFieldValue("currentMicVolume")})}}),{manual:!0}).run;return Object(K.jsxs)(w.a,Object(o.a)(Object(o.a)({form:s},re),{},{initialValues:{audioList:n,currentSpeakerName:null===l||void 0===l?void 0:l.name,currentSpeakerVolume:(null===l||void 0===l?void 0:l.volume)||0,currentMicName:null===p||void 0===p?void 0:p.name,currentMicVolume:(null===p||void 0===p?void 0:p.volume)||0},children:[Object(K.jsx)(w.a.Item,{label:"\u5587\u53ed\u97f3\u91cf",name:"currentSpeakerVolume",children:Object(K.jsx)(C.a,{min:0,max:100,value:null===l||void 0===l?void 0:l.volume,onAfterChange:h})}),Object(K.jsx)(w.a.Item,{label:"\u8f93\u51fa\u8bbe\u5907",name:"currentSpeakerName",children:Object(K.jsx)(ye.a,{onChange:j,children:u.map((function(e){var t=e.name,n=e.displayName,a=e.volume;return Object(K.jsx)(wn,{value:t,children:"".concat(n,"(").concat(a,"%)")},t)}))})}),Object(K.jsx)(w.a.Item,{label:"\u9ea6\u514b\u98ce\u97f3\u91cf",name:"currentMicVolume",children:Object(K.jsx)(C.a,{min:0,max:100,value:t,onAfterChange:v})}),Object(K.jsx)(w.a.Item,{label:"\u9009\u62e9\u9ea6\u514b\u98ce",name:"currentMicName",children:Object(K.jsx)(ye.a,{onChange:O,children:m.map((function(e){var t=e.name,n=e.displayName,a=e.volume;return Object(K.jsx)(wn,{value:t,children:"".concat(n,"(").concat(a,"%)")},t)}))})}),Object(K.jsx)(w.a.Item,{label:"\u5feb\u6377\u64ad\u653e",children:Object(K.jsx)(w.a.List,{name:"audioList",children:function(e,t){var n=t.add,c=t.remove;return Object(K.jsxs)(K.Fragment,{children:[e.map((function(e){var t=e.key,n=e.name,a=Object(dt.a)(e,yn);return Object(K.jsxs)(I.b,{style:{display:"flex",marginBottom:8},align:"baseline",children:[Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},a),{},{name:[n,"type"],extra:"\u7c7b\u578b",children:Object(K.jsxs)(ye.a,{onChange:j,children:[Object(K.jsx)(wn,{value:"audio",children:"\u6587\u4ef6"},"audio"),Object(K.jsx)(wn,{value:"text",children:"\u8bed\u97f3"},"test"),Object(K.jsx)(wn,{value:"stop",children:"\u505c\u6b62"},"stop")]})})),"audio"===s.getFieldValue(["audioList",n,"type"])&&Object(K.jsxs)(K.Fragment,{children:[Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},a),{},{name:[n,"name"],rules:[{required:!0,message:"\u5199\u4e2a\u540d\u5b57\u65e5\u540e\u597d\u76f8\u89c1"}],style:{width:80},extra:"\u540d\u79f0",children:Object(K.jsx)(S.a,{placeholder:"\u5199\u4e2a\u540d\u5b57\u65e5\u540e\u597d\u76f8\u89c1"})})),Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},a),{},{name:[n,"path"],extra:"\u6587\u4ef6\u5728\u6811\u8393\u6d3e\u4e0a\u5b8c\u6574\u8def\u5f84",children:Object(K.jsx)(S.a,{placeholder:"\u6587\u4ef6\u8def\u5f84"})}))]}),"text"===s.getFieldValue(["audioList",n,"type"])&&Object(K.jsx)(K.Fragment,{children:Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},a),{},{name:[n,"text"],extra:"\u8bed\u97f3\u64ad\u62a5\u6587\u672c",children:Object(K.jsx)(S.a,{placeholder:"\u8bed\u97f3\u64ad\u62a5\u6587\u672c",allowClear:!0})}))}),Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},a),{},{name:[n,"keyboard"],style:{width:80},extra:"\u2328\ufe0f \u6309\u952e",children:Object(K.jsx)(S.a,{placeholder:"\u952e\u76d8",prefix:"\u2328\ufe0f"})})),Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},a),{},{name:[n,"gamepadButton"],extra:Object(K.jsxs)("span",{children:["\ud83c\udfae \u7f16\u53f7",Object(K.jsx)("a",{href:"https://gamepad-tester.com",target:"_blank",rel:"noreferrer",children:"\u6d4b\u8bd5\u7f51\u9875"})]}),children:Object(K.jsx)(G.a,{min:0,max:99})})),Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},a),{},{name:[n,"showFooter"],extra:"\u5728\u5e95\u90e8\u663e\u793a",valuePropName:"checked",children:Object(K.jsx)(L.a,{})})),Object(K.jsx)(g.a,{icon:Object(K.jsx)(Jt.a,{}),type:"dashed",onClick:function(){return c(n)}})]},t)})),Object(K.jsx)(w.a.Item,{children:Object(K.jsxs)(I.b,{children:[Object(K.jsx)(g.a,{icon:Object(K.jsx)(tn.a,{}),type:"dashed",onClick:function(){return n({showFooter:!1})}}),Object(K.jsx)(g.a,{type:"primary",onClick:function(){a({audioList:s.getFieldValue("audioList")})},children:"\u4fdd\u5b58"})]})})]})}})})]}))}var Sn=n(432),In=n(433),Ln=n(434),En=n(435),Tn=n(436);function Fn(e){return Object(K.jsxs)(I.b,{align:"center",size:"large",style:{width:"100%",justifyContent:"center"},children:[Object(K.jsxs)("a",{href:"https://network-rc.esonwong.com",target:"_blank",rel:"noopener noreferrer",children:[Object(K.jsx)(Sn.a,{})," Network RC"]}),Object(K.jsxs)("a",{href:"https://twitter.com/eson000",target:"_blank",rel:"noopener noreferrer",children:[Object(K.jsx)(In.a,{})," Twitter"]}),Object(K.jsxs)("a",{href:"https://space.bilibili.com/96740361",target:"_blank",rel:"noopener noreferrer",children:[Object(K.jsx)(Ft,{type:"icon-bilibili-fill"})," B\u7ad9"]}),Object(K.jsxs)("a",{href:"https://www.youtube.com/channel/UCyQR6LHhhhpTFfxZo7VZddA",target:"_blank",rel:"noopener noreferrer",children:[Object(K.jsx)(Ln.a,{})," Youtube"]}),Object(K.jsxs)("a",{href:"https://github.com/itiwll/network-rc",target:"_blank",rel:"noopener noreferrer",children:[Object(K.jsx)(En.a,{})," Github"]}),Object(K.jsxs)("a",{href:"https://blog.esonwong.com/donate/",target:"_blank",rel:"noopener noreferrer",children:[Object(K.jsx)(Tn.a,{})," \u8bf7\u6211\u559d\u676f\u5496\u5561\u5427\uff01"]})]})}var Mn=["onDisconnect","wsConnected","onSubmit","serverConfig","saveServerConfig","resetServerConfig","resetChannel","cameraList","fixedController","changeVolume","changeMicVolume","clearAudioTemp","volume","micVolume","updateVersion","updateStaus"],Nn=Kt.a.TabPane;function Rn(e){e.onDisconnect;var t=e.wsConnected,n=e.onSubmit,a=e.serverConfig,c=e.saveServerConfig,i=e.resetServerConfig,s=e.resetChannel,r=e.cameraList,l=(e.fixedController,e.changeVolume),d=e.changeMicVolume,u=(e.clearAudioTemp,e.volume),j=e.micVolume,h=e.updateVersion,b=e.updateStaus,p=Object(dt.a)(e,Mn);return Object(K.jsxs)(Kt.a,{defaultActiveKey:"1",className:"setting-tabs",children:[Object(K.jsxs)(Nn,{tab:"\u8fde\u63a5\u8bbe\u7f6e",children:[Object(K.jsxs)(w.a,Object(o.a)(Object(o.a)({},re),{},{onFinish:n,initialValues:p,children:[Object(K.jsx)("br",{}),Object(K.jsx)(w.a.Item,{label:"\u8fde\u63a5\u5730\u5740",name:"host",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u8fde\u63a5\u5730\u5740!"}],children:Object(K.jsx)(S.a,{})}),Object(K.jsx)(w.a.Item,{label:"\u542f\u7528 WebRTC",name:"webrtcEnabled",valuePropName:"checked",children:Object(K.jsx)(L.a,{})}),Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},oe),{},{children:Object(K.jsx)(I.b,{children:Object(K.jsx)(g.a,{type:"primary",htmlType:"submit",children:"\u4fdd\u5b58\u5e76\u5237\u65b0"})})}))]})),Object(K.jsx)(Fn,{})]},"1"),Object(K.jsx)(Nn,{tab:"\u57fa\u672c\u8bbe\u7f6e",children:Object(K.jsx)(bn,{saveServerConfig:c,serverConfig:a})},"basic"),Object(K.jsx)(Nn,{tab:"UI \u8bbe\u7f6e",children:Object(K.jsx)(Qt,{resetChannel:s,saveServerConfig:c,serverConfig:a})},"ui"),Object(K.jsx)(Nn,{tab:"\u901a\u9053\u8bbe\u7f6e",children:Object(K.jsx)(jn,{resetChannel:s,saveServerConfig:c,serverConfig:a})},"channel"),Object(K.jsx)(Nn,{tab:"\u6444\u50cf\u5934\u8bbe\u7f6e",children:Object(K.jsxs)(w.a,Object(o.a)(Object(o.a)({},re),{},{onFinish:c,initialValues:a,children:[Object(K.jsx)(w.a.Item,{label:"\u5206\u8fa8\u7387\u6700\u5927\u5bbd\u5ea6",name:"cameraMaxWidth",extra:"\u6444\u50cf\u5934\u753b\u9762\u91c7\u96c6\u7684\u6700\u5927\u5bbd\u5ea6",children:Object(K.jsx)(C.a,{disabled:!t,min:0,max:1024})}),Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},oe),{},{children:Object(K.jsx)(g.a,{onClick:function(){r.forEach((function(e,t){return O.a.remove("camera-".concat(p.host,"/video").concat(t))})),window.location.reload()},children:"\u91cd\u7f6e\u6444\u50cf\u5934"})})),Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},oe),{},{children:Object(K.jsx)(g.a,{type:"primary",disabled:!t,htmlType:"submit",children:"\u4fdd\u5b58"})}))]}))},"camera"),Object(K.jsx)(Nn,{tab:"\u58f0\u97f3\u8bbe\u7f6e",children:Object(K.jsx)(kn,{changeVolume:l,changeMicVolume:d,micVolume:j,volume:u,wsConnected:t,saveServerConfig:c,audioList:a.audioList,host:p.host})},"sound"),Object(K.jsx)(Nn,{tab:"\u5206\u4eab\u8bbe\u7f6e",children:Object(K.jsx)(qt,{wsConnected:t,saveServerConfig:c,sharedCode:a.sharedCode,sharedDuration:a.sharedDuration,sharedEndTime:a.sharedEndTime})},"shared"),Object(K.jsx)(Nn,{tab:"\u5907\u4efd\u548c\u66f4\u65b0",children:Object(K.jsx)(xn,{resetServerConfig:i,saveServerConfig:c,serverConfig:a,updateVersion:h,updateStaus:b})},"backup")]})}var Dn=n(445),Pn=n(216),Vn=n.n(Pn);function zn(e){var t=e.onSubmit;return Object(Et.a)((function(){var e=Vn.a.parse(window.location.search.replace("?",""))["shared-code"];e&&setTimeout((function(){t({sharedCode:e})}),2e3)})),Object(K.jsxs)(w.a,Object(o.a)(Object(o.a)({},re),{},{onFinish:t,children:[Object(K.jsx)(w.a.Item,{label:"\u5bc6\u7801",name:"password",children:Object(K.jsx)(S.a,{type:"password"})}),Object(K.jsx)(w.a.Item,Object(o.a)(Object(o.a)({},oe),{},{children:Object(K.jsx)(g.a,{type:"primary",htmlType:"submit",children:"\u767b\u5f55"})}))]}))}var Kn=n(217),An=n.n(Kn),_n=n(173),Bn=n.n(_n),Un=n(438),Wn=n(439),Gn=n(440),qn=n(437),Hn=n(441),Jn=n(442),Yn=n(443),Xn=n(444),Zn=n(446);function Qn(e){var t=e.url,n=e.connectType,c=e.onMicphoneChange,i=Object(a.useRef)(null),s=Object(a.useState)(!1),r=Object(Le.a)(s,2),o=r[0],l=r[1],d=Object(a.useState)(null),u=Object(Le.a)(d,2),j=u[0],h=u[1];return Object(tt.a)((function(){if("ws"===n){var e=function(){var e=s.addSourceBuffer("audio/mpeg");setInterval((function(){r.length&&!e.updating&&e.appendBuffer(r.shift())}),10),(a=new WebSocket(t)).binaryType="arraybuffer",a.addEventListener("message",(function(e){var t=e.data;if(r.push(t),i.current.buffered.length){var n=1+1.2*(i.current.buffered.end(0)-i.current.currentTime-.8);i.current.playbackRate=n<0?.5:n>3?3:n}})),a.addEventListener("open",(function(){l(!0)})),a.addEventListener("close",(function(){l(!1)}))};if(!i.current||!o)return;if(!window.MediaSource)return v.b.warn("\u79fb\u52a8\u7248\u7684 safari \u6d4f\u89c8\u5668\u6682\u4e0d\u652f\u6301\u6536\u542c\u58f0\u97f3 \ud83d\ude22"),void setTimeout((function(){l(!1)}),1e3);var a,s=new MediaSource,r=[];return s.addEventListener("sourceopen",e),h(URL.createObjectURL(s)),function(){a&&a.close(),s.removeEventListener("sourceopen",e)}}c(o)}),[i,o,t,n,c],{wait:500}),Object(K.jsxs)("div",{children:[Object(K.jsx)("audio",{ref:i,src:j,autoPlay:!0}),Object(K.jsx)(L.a,{checked:o,onChange:function(e){l(e),O.a.set("audio-enabled",e)},checkedChildren:Object(K.jsxs)(K.Fragment,{children:[Object(K.jsx)(Y.a,{})," ",Object(K.jsx)(Ve.a,{})]}),unCheckedChildren:Object(K.jsxs)(K.Fragment,{children:[Object(K.jsx)(Y.a,{})," ",Object(K.jsx)(qn.a,{})]})})]})}function $n(e){var t=e.statusInfo,n=e.piPowerOff,a=e.wsConnected,c=e.delay,i=void 0===c?0:c,s=e.isFullscreen,r=e.setting,o=e.isLogin,l=e.session,d=e.changeEditabled,u=e.channelStatus,j=e.changeChannel,h=e.serverConfig,b=e.version,p=e.connectType,f=e.onCarMicphoneChange,m=e.locked,O=e.onControllerMicphoneChange,v=void 0===O?function(){}:O,x=e.enabledControllerMicphone,C=void 0===x||x,k="webrtc"===p,S=h.sharedEndTime;return Object(D.a)("t",(function(){return v(!C)}),{events:["keyup"]}),Object(Re.a)("gamepadpress",(function(e){var t=e.detail,n=t.index,a=t.value;3===n&&a>.5&&v(!C)})),Object(K.jsxs)(w.a,{layout:"inline",className:"app-status",size:"small",children:[Object(K.jsxs)(w.a.Item,{children:[Object(K.jsx)(y.a,{to:"".concat("","/controller"),children:Object(K.jsx)("img",{className:"logo",src:"/logo-256.png",alt:"N-RC"})}),Object(K.jsx)("span",{children:"N RC"})]}),Object(K.jsx)(w.a.Item,{children:Object(K.jsxs)(q.a,{style:{width:"7em"},icon:m?Object(K.jsx)(N.a,{}):a?Object(K.jsx)(Un.a,{}):Object(K.jsx)(Wn.a,{}),color:m||i>80||!a?"red":"green",size:"xs",children:[k?"\u76f4\u8fde":"\u4e2d\u8f6c",":",i.toFixed(0)]})}),(h.channelList||[]).filter((function(e){var t=e.enabled,n=e.type;return t&&"switch"===n})).map((function(e){var t=e.pin,n=e.name;return Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(L.a,{checked:u[t]||!1,checkedChildren:n,unCheckedChildren:n,onChange:function(e){return j({pin:t,value:e})}})},t)})),o&&k&&Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(L.a,{checked:C,onChange:v,checkedChildren:Object(K.jsxs)(K.Fragment,{children:[Object(K.jsx)(Gn.a,{})," ",Object(K.jsx)(Ve.a,{})]}),unCheckedChildren:Object(K.jsxs)(K.Fragment,{children:[Object(K.jsx)(Gn.a,{})," ",Object(K.jsx)(qn.a,{})]})})}),o&&Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(Qn,{session:l,connectType:p,onMicphoneChange:f,url:"".concat("https:"===window.location.protocol?"wss://":"ws://").concat(r.host,"/microphone")})}),Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(L.a,{checkedChildren:Object(K.jsx)(Hn.a,{}),unCheckedChildren:Object(K.jsx)(Hn.a,{}),onChange:d})}),Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(y.a,{to:"".concat("","/setting"),children:Object(K.jsx)(g.a,{size:"small",icon:Object(K.jsx)(Jn.a,{}),shape:"circle"})})}),document.body.requestFullscreen&&Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(g.a,{type:"primary",shape:"circle",icon:s?Object(K.jsx)(Yn.a,{}):Object(K.jsx)(Xn.a,{}),onClick:function(){s?document.exitFullscreen():document.body.requestFullscreen()}})}),a&&o&&Object(K.jsx)(w.a.Item,{children:Object(K.jsx)(g.a,{type:"danger",shape:"circle",icon:Object(K.jsx)(Dn.a,{}),onClick:n})}),a&&o&&Object.keys(t).map((function(e){var n=t[e],a=n.color,c=n.label,i=n.value;return["gps"].includes(c)?void 0:Object(K.jsx)(w.a.Item,{children:Object(K.jsxs)(q.a,{color:a,children:[c,":",i]})},e)})),a&&S&&Object(K.jsx)(w.a.Item,{children:Object(K.jsxs)(q.a,{icon:Object(K.jsx)(Zn.a,{}),color:l&&l.endTime&&"orange",children:[((S-(new Date).getTime())/1e3).toFixed(0),"s"]})}),b&&Object(K.jsx)(w.a.Item,{children:Object(K.jsxs)(q.a,{children:["v",b]})})]})}var ea=n(174),ta=n.n(ea),na=function(){function e(t){var n=this,a=t.video,c=t.micphoneEanbled,i=void 0!==c&&c,s=t.socket,r=t.onSuccess,o=t.onClose,l=t.onDataChannel;Object(j.a)(this,e),this.onSocketMessage=function(e){var t=e.data;if("string"===typeof t){var a=t=JSON.parse(t),c=a.action,i=a.payload;if(-1!==c.indexOf("webrtc"))switch(c.split(" ")[1]){case"offer":n.onOffer(i);break;case"candidate":n.addCandidate(i);break;default:console.log(c)}}},this.onOffer=function(){var e=Object(u.a)(d.a.mark((function e(t){var a,c,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("WebRTC Get offer",t),(a=new RTCPeerConnection({iceServers:[{urls:"stun:gz.esonwong.com:34578",username:"network-rc",credential:"network-rc"},{urls:["stun:turn2.l.google.com"]},{urls:"stun:stun.miwifi.com"},{urls:"stun:stun.l.google.com:19302"}]})).addEventListener("datachannel",(function(e){var t=e.channel,a=t.label;console.log("WebRTC [".concat(a,"] Data Channel open"),t),n.onDataChannel(t)})),a.addEventListener("connectionstatechange",(function(e){var t,c=e.target;(console.log("Connection state change",c.connectionState),"connected"===c.connectionState)&&(null===n||void 0===n||null===(t=n.onSuccess)||void 0===t||t.call(n,{}),console.log("RTC",a));"disconnected"===c.connectionState&&n.close()})),a.addEventListener("iceconnectionstatechange",(function(e){})),a.addEventListener("icecandidate",(function(e){var t=e.candidate;t&&n.socketSend({type:"candidate",payload:t})})),a.addEventListener("icecandidateerror",(function(e){console.error("icecandidateerror",e)})),n.rc=a,e.next=10,a.setRemoteDescription(t);case 10:return console.log("receivers",a.getReceivers()),c=new MediaStream(a.getReceivers().map((function(e){return e.track}))),n.audioEl.srcObject=c,e.next=15,n.addAudioTrack();case 15:return e.next=17,a.createAnswer();case 17:return i=e.sent,console.log("WebRTC answer",i),e.next=21,a.setLocalDescription(i);case 21:n.socketSend({type:"answer",payload:i});case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.video=a,this.socket=s,this.onSuccess=r,this.onClose=o,this.onDataChannel=l,this.micphoneEanbled=i,this.socketSend({type:"connect"}),this.socket.addEventListener("message",this.onSocketMessage),this.audioEl=document.createElement("audio"),document.body.appendChild(this.audioEl)}return Object(h.a)(e,[{key:"socketSend",value:function(e){var t=e.type,n=e.payload;this.socket.send(JSON.stringify({action:"webrtc ".concat(t),payload:n}))}},{key:"addCandidate",value:function(e){e&&this.rc.addIceCandidate(new RTCIceCandidate(e))}},{key:"playAudio",value:function(e){e?this.audioEl.play():this.audioEl.pause()}},{key:"addAudioTrack",value:function(){var e=Object(u.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,window.navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).catch((function(e){throw console.error(e),e}));case 3:this.localStream=e.sent,this.localStream.getTracks().forEach((function(e){e.enabled=t.micphoneEanbled,t.rc.addTrack(e)})),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0),v.b.error("\u5f00\u542f\u8bed\u97f3\u5931\u8d25 "+e.t0.message);case 11:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"changeMicrophone",value:function(){var e=Object(u.a)(d.a.mark((function e(){var t=this;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.micphoneEanbled=!this.micphoneEanbled,this.localStream&&this.localStream.getTracks().forEach((function(e){return e.enabled=t.micphoneEanbled}));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"close",value:function(){var e,t;this.socket.removeEventListener("message",this.onSocketMessage),this.localStream&&this.localStream.getTracks().forEach((function(e){return e.stop()})),null===(e=this.rc)||void 0===e||null===(t=e.close)||void 0===t||t.call(e),this.rc=void 0,this.audioEl.srcObject=null,this.video&&(this.video.srcObject=null),this.socketSend({type:"close"}),this.onClose()}}]),e}(),aa="",ca=function(e){Object(p.a)(n,e);var t=Object(f.a)(n);function n(e){var c;Object(j.a)(this,n),(c=t.call(this,e)).connect=function(){var e,t,n=c.state.setting.host,a=c.socket=new WebSocket("".concat("https:"===window.location.protocol?"wss://":"ws://").concat(n,"/control"));a.binaryType="arraybuffer",a.addEventListener("open",(function(){c.setState({wsConnected:!0,connectType:"ws"}),e=setInterval((function(){var e=(new Date).getTime();c.sendData("ping",{sendTime:e})}),1e3),t=setInterval((function(){c.sendData("heartbeat")}),200),setTimeout((function(){return c.login()}),200)})),a.addEventListener("message",function(){var e=Object(u.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.data,c.messageHandle(n);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.addEventListener("close",(function(){clearInterval(e),clearInterval(t),c.setState({wsConnected:!1}),setTimeout((function(){v.b.error("\u65ad\u5f00\u8fde\u63a5\uff0c\u6b63\u5728\u91cd\u8fde\uff01"),c.connect()}),3e3)}))},c.updateVersion=function(){c.sendData("update")},c.onLogin=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.message,n=void 0===t?"\u65e0\u5bc6\u7801":t,a=e.session;v.b.success(n),c.setState({isLogin:!0,session:a}),O.a.set("network-rc-session",a),document.referrer.indexOf(window.location.host)>-1&&window.history.length>1?Object(y.d)(-1):Object(y.d)("".concat(aa,"/controller"),{replace:!0}),c.getServerConfig(),c.state.setting.webrtcEnabled&&c.openWebRTC()},c.playCarMicphonne=function(e){var t,n;null===(t=c.webrtc)||void 0===t||null===(n=t.playAudio)||void 0===n||n.call(t,e)},c.changeControllerMicphone=function(){var e;c.setState({enabledControllerMicphone:!c.state.enabledControllerMicphone}),null===(e=c.webrtc)||void 0===e||e.changeMicrophone()},c.disconnect=function(e){e&&e.preventDefault(),c.setState({wsConnected:!1}),c.socket&&c.socket.close()},c.login=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.password,n=e.sharedCode,a=O.a.get("network-rc-session")||{};c.sendData("login",{token:t?An()("".concat(t,"eson")):void 0,sharedCode:n,sessionId:a.id})},c.changeLight=function(e){c.state.wsConnected&&c.sendData("open light",e)},c.changePower=function(e){c.state.wsConnected&&c.sendData("open power",e)},c.piPowerOff=function(){if(c.state.wsConnected)var e=x.a.warning({autoFocusButton:"cancel",icon:Object(K.jsx)(Dn.a,{}),title:"\u786e\u5b9a\u8981\u5173\u95ed Pi \u9171\u7cfb\u7edf\uff1f",content:Object(K.jsxs)(a.Fragment,{children:[Object(K.jsx)(g.a,{type:"danger",icon:Object(K.jsx)(Dn.a,{}),onClick:function(){c.sendData("pi power off"),e.destroy()},children:"\u5173\u673a"}),"\xa0",Object(K.jsx)(g.a,{icon:Object(K.jsx)(mn.a,{}),onClick:function(){c.sendData("pi reboot"),e.destroy()},children:"\u91cd\u542f"})]}),maskClosable:!0,okText:"\u53d6\u6d88"})},c.changeEditabled=function(e){c.setState({editabled:e})},c.changeSetting=function(e){c.setState({setting:e}),O.a.set("setting",e),Object(y.d)("".concat(aa,"/controller")),window.location.reload()},c.changeZeroSpeedRate=function(e){c.state.wsConnected&&(c.sendData("speed zero rate",e),c.setState({speedZeroRate:e}))},c.changeSpeed=function(e){c.state.wsConnected&&c.sendData("speed rate",e)},c.changeDirection=function(e){c.sendData("direction rate",e)},c.tts=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"\u4e00\u8d77\u73a9\u7f51\u7edc\u9065\u63a7\u8f66";c.setState({ttsPlaying:!0}),c.sendData("tts",{text:e})},c.playAudio=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.path,n=e.text,a=e.stop,i=void 0!==a&&a;n?c.tts(n):c.sendData("play audio",{path:t,stop:i})},c.changeVolume=function(e){c.sendData("volume",e)},c.changeMicVolume=function(e){c.sendData("micVolume",e)},c.changeChannel=function(e){var t=e.pin,n=e.value;P[t]=n,c.sendData("change channel",e)},c._saveServerConfig=function(e){var t=c.state.setting.host;ta.a.post("//".concat(t,"/config"),e).then((function(){v.b.success("\u4fdd\u5b58\u6210\u529f")})).catch((function(e){console.error(e)}))},c.resetServerConfig=function(){c.sendData("reset config")},c._resetChannel=function(){c.sendData("reset channel")},c.appRef=Object(a.createRef)(),c.state={editabled:!1,cameraList:[],setting:Object(o.a)({host:window.location.host,webrtcEnabled:!0},O.a.get("setting")),serverConfig:{},gpioChannelStatus:{},wsConnected:!1,cameraEnabled:!1,lightEnabled:!1,powerEnabled:!1,canvasRef:void 0,isAiControlling:!1,isFullscreen:!1,videoSize:50,delay:void 0,connectType:"ws",action:{speed:0,direction:0},ttsPlaying:!1,isLogin:!1,volume:0,micVolume:0,session:{},version:void 0,updateStaus:void 0,webrtcChannel:[],locaked:!1,enabledControllerMicphone:!1,statusInfo:{}};var i=Object(b.a)(c),s=i.changeLight,r=i.changePower;return c.controller={changeLight:s,changePower:r,speed:function(e){var t=Object(b.a)(c),n=t.changeSpeed,a=t.state.action;a.speed=e,c.setState({action:Object(o.a)({},a)}),n(a.speed)},direction:function(e){var t=Object(b.a)(c),n=t.changeDirection,a=t.state.action;a.direction=e,n(e),c.setState({action:Object(o.a)({},a)})}},c.saveServerConfig=Bn()(c._saveServerConfig,300),c.resetChannel=Bn()(c._resetChannel,300),c}return Object(h.a)(n,[{key:"componentDidMount",value:function(){var e=this;(0,this.connect)(),document.body.addEventListener("fullscreenchange",(function(){document.fullscreenElement?e.setState({isFullscreen:!0}):e.setState({isFullscreen:!1})}))}},{key:"messageHandle",value:function(e){var t=this.state,n=t.gpioChannelStatus,a=t.serverConfig,c=t.statusInfo;if("string"===typeof e){var i=JSON.parse(e),s=i.action,l=i.payload;switch(s){case"connect type":this.setState({connectType:l});break;case"version":this.setState({version:l});break;case"camera list":this.setState({cameraList:l});break;case"login":this.onLogin(l);break;case"config":this.setState({serverConfig:Object(o.a)(Object(o.a)({},a),l)});break;case"config update":this.getServerConfig();break;case"volume":this.setState({volume:l});break;case"micVolume":this.setState({micVolume:l});break;case"channel status":this.setState({gpioChannelStatus:Object(o.a)(Object(o.a)({},n),l)});break;case"tts playing":this.setState({ttsPlaying:l});break;case"locked":this.setState({locked:l});break;case"status info":this.setState({statusInfo:Object(o.a)(Object(o.a)({},c),{},Object(r.a)({},l.label,l))});break;case"update-status":this.setState({updateStaus:l});break;case"before-restart":setTimeout((function(){window.location.reload()}),5e3);break;case"pong":this.setState({delay:((new Date).getTime()-l.sendTime)/2});break;case"info":v.b.info(l.message);break;case"warn":v.b.warn(l.message);break;case"error":"auth error"===l.type&&"/login"!==window.location.pathname&&Object(y.d)("".concat(aa,"/login")),v.b.error(l.message);break;case"success":v.b.success(l.message)}}}},{key:"sendData",value:function(e,t){var n,a;this.state.wsConnected&&("open"===(null===this||void 0===this||null===(n=this.webrtcChannel)||void 0===n||null===(a=n.controller)||void 0===a?void 0:a.readyState)?this.webrtcChannel.controller.send(JSON.stringify({action:e,payload:t})):this.socket.send(JSON.stringify({action:e,payload:t})))}},{key:"getServerConfig",value:function(){var e=Object(u.a)(d.a.mark((function e(){var t,n,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0}),t=this.state.setting.host,e.prev=2,e.next=5,ta()("//".concat(t,"/config"));case 5:n=e.sent,a=n.data,this.setState({serverConfig:a});case 8:return e.prev=8,this.setState({loading:!1}),e.finish(8);case 11:case"end":return e.stop()}}),e,this,[[2,,8,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"openWebRTC",value:function(){var e,t,n=this;null===(e=this.webrtc)||void 0===e||null===(t=e.close)||void 0===t||t.call(e),this.state.isLogin&&(this.webrtc=new na({micphoneEanbled:this.state.enabledControllerMicphone,socket:this.socket,onClose:function(){delete this.webrtc},onDataChannel:function(e){var t=e.label;n.webrtcChannel?n.webrtcChannel[t]=e:n.webrtcChannel=Object(r.a)({},t,e),n.setState({webrtcChannel:n.webrtcChannel}),"controller"===e.label&&(n.setState({locked:!1}),e.addEventListener("message",(function(e){var t=e.data;return n.messageHandle(t)})))},onDataChannelClose:function(e){n.webrtcChannel[e.label]&&(delete n.webrtcChannel[e.label],n.setState({webrtcChannel:n.webrtcChannel}))}}))}},{key:"render",value:function(){var e=this.disconnect,t=this.controller,n=this.changeChannel,a=this.changeSetting,c=this.changeLight,i=this.changePower,s=this.piPowerOff,r=this.login,l=this.saveServerConfig,d=this.resetServerConfig,u=this.resetChannel,j=this.changeVolume,h=this.changeMicVolume,b=this.changeEditabled,p=this.updateVersion,f=this.state,m=f.version,O=f.cameraList,v=f.setting,x=f.wsConnected,g=f.cameraEnabled,w=f.action,C=f.isFullscreen,k=f.serverConfig,S=f.lightEnabled,I=f.delay,L=f.powerEnabled,E=f.isLogin,T=f.ttsPlaying,F=f.volume,M=f.micVolume,N=f.session,R=f.editabled,D=f.gpioChannelStatus,P=f.updateStaus,V=f.connectType,z=f.webrtcChannel,A=f.locked,_=f.enabledControllerMicphone,B=f.statusInfo,U=this.tts,W=this.playAudio,G=this.playCarMicphonne,q=this.changeControllerMicphone;return Object(K.jsxs)("div",{className:"App",ref:this.appRef,children:[!C&&Object(K.jsx)($n,{statusInfo:B,channelStatus:D,delay:I,connectType:V,onCarMicphoneChange:G,onControllerMicphoneChange:q,locked:A,version:m,wsConnected:x,isFullscreen:C,lightEnabled:S,powerEnabled:L,changePower:i,changeLight:c,piPowerOff:s,setting:v,isLogin:E,session:N,changeEditabled:b,editabled:R,changeChannel:n,serverConfig:k,updateStaus:P,enabledControllerMicphone:_,disabled:!E}),Object(K.jsxs)(y.c,{className:"app-page",children:[Object(K.jsx)(Rn,Object(o.a)(Object(o.a)({path:"".concat(aa,"/setting")},v),{},{cameraList:O,wsConnected:x,onDisconnect:e,onSubmit:a,saveServerConfig:l,resetServerConfig:d,resetChannel:u,serverConfig:k,changeVolume:j,changeMicVolume:h,volume:F,micVolume:M,updateVersion:p,updateStaus:P})),x&&Object(K.jsx)(zn,{path:"".concat(aa,"/login"),onSubmit:r}),E?Object(K.jsx)(K.Fragment,{children:Object(K.jsx)(zt,{statusInfo:B,connectType:V,session:N,path:"".concat(aa,"/controller"),controller:t,lightEnabled:S,cameraEnabled:g,action:w,powerEnabled:L,onTTS:U,playAudio:W,ttsPlaying:T,setting:v,saveServerConfig:l,serverConfig:k,changeChannel:n,editabled:R,cameraList:O,channelStatus:D,isFullscreen:C,webrtcChannel:z})}):void 0]})]})}}]),n}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ia=Object(Ot.a)({reducer:{ui:wt}});s.a.render(Object(K.jsx)(mt.a,{store:ia,children:Object(K.jsx)(c.a.StrictMode,{children:Object(K.jsx)(ca,{})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[378,1,2]]]);